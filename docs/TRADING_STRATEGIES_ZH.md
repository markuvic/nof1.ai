# 交易策略配置指南

本文档详细说明 open-nof1.ai 系统支持的所有交易策略及其配置方法。

## 快速配置指南

### 如何修改策略配置？

1. **修改策略类型**：编辑 `.env` 文件，修改 `TRADING_STRATEGY` 参数
2. **修改执行周期**：编辑 `.env` 文件，修改 `TRADING_INTERVAL_MINUTES` 参数
3. **修改风控参数**：编辑 `.env` 文件，修改 `MAX_LEVERAGE`、`MAX_POSITIONS` 等参数
4. **修改策略核心参数**：编辑对应策略文件（如 `src/strategies/swingTrend.ts`）
5. **查看完整配置对照**：参考本文档末尾的"配置项与代码对照表"

### 配置文件位置速查

| 配置类型 | 文件位置 | 说明 |
|---------|---------|------|
| 环境变量配置 | `.env` | 策略选择、执行周期、风控参数 |
| 策略参数定义 | `src/strategies/*.ts` | 各策略的杠杆、仓位、止损等参数 |
| 风控参数 | `src/config/riskParams.ts` | 系统级风控参数 |
| 策略选择逻辑 | `src/strategies/index.ts` | 策略切换逻辑 |
| 交易循环 | `src/scheduler/tradingLoop.ts` | 自动监控、止损止盈实现 |
| AI决策提示词 | `src/agents/tradingAgent.ts` | AI交易决策逻辑 |

---

## 策略文件位置

所有策略实现文件位于 `src/strategies/` 目录下：

- `src/strategies/index.ts` - 策略模块统一导出
- `src/strategies/types.ts` - 策略类型定义
- `src/strategies/ultraShort.ts` - 超短线策略实现
- `src/strategies/swingTrend.ts` - 波段趋势策略实现
- `src/strategies/mediumLong.ts` - **中长线策略实现**
- `src/strategies/conservative.ts` - 稳健策略实现
- `src/strategies/balanced.ts` - 平衡策略实现
- `src/strategies/aggressive.ts` - 激进策略实现
- `src/strategies/aggressiveTeam.ts` - 激进团策略实现
- `src/strategies/rebateFarming.ts` - 返佣套利策略实现
- `src/strategies/aiAutonomous.ts` - AI自主策略实现
- `src/strategies/multiAgentConsensus.ts` - 陪审团策略实现
- `src/strategies/alphaBeta.ts` - **Alpha Beta策略实现**
- `src/agents/aggressiveTeamAgents.ts` - 激进团团员实现

## 策略概览

系统目前支持 **11 种交易策略**，适应不同的市场环境和风险偏好：

| 策略代码 | 策略名称 | 执行周期 | 持仓时长 | 风险等级 | 适合人群 |
|---------|---------|---------|---------|---------|---------|
| `ultra-short` | 超短线 | 5分钟 | 30分钟-2小时 | 中高 | 喜欢高频交易、快进快出的交易者 |
| `swing-trend` | **波段趋势** | **20分钟** | **数小时-3天** | **中低** | **追求中长期趋势、稳健成长的投资者** |
| `medium-long` | **中长线** | **30分钟** | **数小时-24小时** | **中** | **追求中长期稳健收益，AI主导决策** |
| `conservative` | 稳健 | 5-15分钟 | 数小时-24小时 | 低 | 保守投资者 |
| `balanced` | 平衡 | 5-15分钟 | 数小时-24小时 | 中 | 一般投资者 |
| `aggressive` | 激进 | 5-15分钟 | 数小时-24小时 | 高 | 激进投资者 |
| `aggressive-team` | **激进团** | **15分钟** | **数小时-2天** | **高** | **团队协作+震荡识别强化，追求40-60%月回报的激进投资者** |
| `rebate-farming` | **返佣套利** | **5分钟** | **10-60分钟** | **中** | **拥有高额手续费返佣的用户** |
| `ai-autonomous` | **AI自主** | **灵活** | **AI决定** | **AI决定** | **完全信任AI能力，追求最大灵活性的交易者** |
| `multi-agent-consensus` | **陪审团** | **5-10分钟** | **数小时-数天** | **中** | **追求稳健决策、重视风险控制的投资者** |
| `alpha-beta` | **Alpha Beta** | **灵活** | **AI决定** | **AI决定** | **零策略指导，AI完全自主决策，强制自我复盘** |

## 策略详细说明

### 超短线策略 (`ultra-short`)

**核心理念**：快进快出，捕捉短期价格波动，严格执行锁利规则

#### 策略参数

> **配置文件位置**：`src/strategies/ultraShort.ts`

- **执行周期**：5分钟（配置位置：`.env` 文件 `TRADING_INTERVAL_MINUTES=5`）
- **建议持仓时长**：30分钟 - 2小时
- **杠杆范围**：3-5倍（根据MAX_LEVERAGE的50%-75%）
  - 代码：`leverageMin: Math.max(3, Math.ceil(maxLeverage * 0.5))`
  - 代码：`leverageMax: Math.max(5, Math.ceil(maxLeverage * 0.75))`
- **仓位大小**：18-25%
  - 代码：`positionSizeMin: 18, positionSizeMax: 25`
- **止损范围**：-1.5% ~ -2.5%
  - 代码：`stopLoss: { low: -2.5, mid: -2, high: -1.5 }`

#### 风控规则（系统强制执行）

> **代码实现位置**：`src/agents/tradingAgent.ts` → AI提示词 + `src/scheduler/tradingLoop.ts`

1. **周期锁利规则**：每个5分钟周期内，盈利>2%且<4%时，立即平仓锁定利润
   - AI在每个周期会检查盈利情况并执行锁利
2. **30分钟规则**：持仓超过30分钟且盈利>手续费成本时，如未达移动止盈线，执行保守平仓
   - AI在提示词中包含此规则，自动判断执行
3. **移动止盈**：
   - 盈利≥+4% → 止损移至+1.5%
     - 代码：`trailingStop.level1: { trigger: 4, stopAt: 1.5 }`
   - 盈利≥+8% → 止损移至+4%
     - 代码：`trailingStop.level2: { trigger: 8, stopAt: 4 }`
   - 盈利≥+15% → 止损移至+8%
     - 代码：`trailingStop.level3: { trigger: 15, stopAt: 8 }`

#### 适用场景
- 市场波动剧烈，短期趋势明确
- 有充足时间监控系统运行
- 追求快速资金周转

#### 配置示例

> **配置文件位置**：`.env` 文件（参考 `.env.example`）

```bash
TRADING_STRATEGY=ultra-short
TRADING_INTERVAL_MINUTES=5
MAX_LEVERAGE=10
```

---

### 波段趋势策略 (`swing-trend`)

**核心理念**：短周期精准入场，耐心持仓，自动监控保护，让利润充分奔跑

#### 策略参数

> **配置文件位置**：`src/strategies/swingTrend.ts`

- **执行周期**：**20分钟**（配置位置：`.env` 文件 `TRADING_INTERVAL_MINUTES=20`）
- **建议持仓时长**：**数小时 - 3天**
- **杠杆范围**：**2-5倍**（根据信号强度灵活选择）
  - 代码：`leverageMin: Math.max(2, Math.ceil(maxLeverage * 0.2))`
  - 代码：`leverageMax: Math.max(5, Math.ceil(maxLeverage * 0.5))`
- **仓位大小**：**20-35%**（根据信号强度：普通20-25%、良好25-30%、强30-35%）
  - 代码：`positionSizeMin: 20, positionSizeMax: 35`
- **止损范围**：**-5.5% ~ -9%**（根据杠杆：高杠杆-5.5%、中杠杆-7.5%、低杠杆-9%）
  - 代码：`stopLoss: { low: -9, mid: -7.5, high: -5.5 }`

#### 核心优势
1. **短周期精准入场**：使用1分钟、3分钟、5分钟、15分钟四个时间框架共振
2. **自动监控保护**：止损和止盈完全由自动监控系统执行（每10秒检查）
3. **AI专注开仓**：AI只负责寻找高质量开仓机会，不主动平仓
4. **更大仓位**：最高可达35%，提升盈利潜力
5. **追求趋势利润**：首次止盈目标+50%，最高可达+120%

#### 自动监控止损（每10秒自动检查）

> **代码实现位置**：`src/scheduler/tradingLoop.ts` → `stopLossMonitor()`

- **5-7倍杠杆**：亏损达到 -8% 时自动止损
- **8-12倍杠杆**：亏损达到 -6% 时自动止损
- **13倍以上杠杆**：亏损达到 -5% 时自动止损

#### 自动监控移动止盈（每10秒自动检查，5级规则）

> **代码实现位置**：`src/scheduler/tradingLoop.ts` → `stopLossMonitor()`

- **阶段1**：峰值盈利4-6%，回退1.5%自动平仓（保底2.5%）
- **阶段2**：峰值盈利6-10%，回退2%自动平仓（保底4%）
- **阶段3**：峰值盈利10-15%，回退2.5%自动平仓（保底7.5%）
- **阶段4**：峰值盈利15-25%，回退3%自动平仓（保底12%）
- **阶段5**：峰值盈利25%+，回退5%自动平仓（保底20%）

#### 入场条件（AI执行）
- **必须1分钟、3分钟、5分钟、15分钟这4个时间框架信号全部强烈一致**
- **关键指标共振（MACD、RSI、EMA方向一致）**
- **短周期精准捕捉，快速入场**
- **重视信号质量而非数量**

#### AI职责说明
- **只负责开仓**：分析市场，寻找高质量开仓机会
- **禁止主动平仓**：AI不会也不应该主动调用平仓操作
- **监控和报告**：分析持仓状态，在报告中说明风险和趋势健康度
- **信任自动监控**：所有平仓由自动监控系统自动处理

#### 适用场景
- **追求稳定收益，降低人为干预**
- **希望系统自动化保护利润**
- **能接受数小时到数天的持仓周期**
- **资金规模较大，重视风险控制**

#### 配置示例

> **配置文件位置**：`.env` 文件（参考 `.env.example`）

```bash
# 环境变量配置
TRADING_STRATEGY=swing-trend
TRADING_INTERVAL_MINUTES=20
MAX_LEVERAGE=10  # 策略实际使用2-5倍，留足安全边际
MAX_POSITIONS=3  # 减少同时持仓数量
INITIAL_BALANCE=2000
```

#### 预期收益
- **月目标收益**：20-35%
- **胜率目标**：35-45%
- **盈亏比目标**：≥2:1
- **夏普比率**：≥1.5

#### 与超短线策略对比

| 维度 | 超短线 (ultra-short) | 波段趋势 (swing-trend) |
|-----|---------------------|---------------------|
| 执行周期 | 5分钟 | **20分钟** |
| 杠杆倍数 | 3-5倍 | **2-5倍** |
| 仓位大小 | 18-25% | **20-35%** |
| 止损幅度 | -1.5%~-2.5% | **-5.5%~-9%** |
| 入场时间框架 | 多时间框架 | **1m/3m/5m/15m精准** |
| 持仓时长 | 30分钟-2小时 | **数小时-3天** |
| 平仓方式 | AI主动执行 | **自动监控执行** |
| AI职责 | 开仓+平仓 | **只负责开仓** |
| 风险等级 | 中高 | **中低** |
| 适合行情 | 短期波动 | **中期趋势** |

---

### 中长线策略 (`medium-long`)

**核心理念**：最小限制，最大自由度，充分发挥AI的分析和决策能力

#### 策略参数

> **配置文件位置**：`src/strategies/mediumLong.ts`

- **执行周期**：**30分钟**（配置位置：`.env` 文件 `TRADING_INTERVAL_MINUTES=30`）
- **建议持仓时长**：**数小时 - 24小时**
- **杠杆范围**：**3-10倍**（固定范围，给AI充分自主权）
  - 代码：`leverageMin: 3, leverageMax: 10`
- **仓位大小**：**15-35%**（灵活配置，根据市场情况调整）
  - 代码：`positionSizeMin: 15, positionSizeMax: 35`
- **止损范围**：**-4.5% ~ -8%**（根据杠杆：高杠杆-4.5%、中杠杆-6%、低杠杆-8%）
  - 代码：`stopLoss: { low: -8, mid: -6, high: -4.5 }`

#### 核心优势

1. **AI主导决策**：最小限制，充分信任AI的分析能力
2. **灵活杠杆选择**：3-10倍范围内灵活运用
3. **灵活仓位配置**：15-35%范围，根据信号强度调整
4. **宽松止损空间**：给趋势足够发展空间
5. **AI主动止盈止损**：不受固定规则限制

#### AI止损止盈（由AI主动执行）

> **代码实现位置**：`src/strategies/mediumLong.ts`

- **止损建议**：
  - 低杠杆（3-5倍）：-8%止损（给趋势足够空间）
  - 中杠杆（5-7倍）：-6%止损（平衡空间和风险）
  - 高杠杆（7-10倍）：-4.5%止损（严格控制风险）

- **移动止盈建议**：
  - 盈利达到 +12% → 止损线移至 +5%（保护7%空间）
  - 盈利达到 +25% → 止损线移至 +15%（保护10%空间）
  - 盈利达到 +40% → 止损线移至 +28%（保护12%空间）

- **分批止盈建议**：
  - 盈利达到 +35% → 平仓30%（保留70%追求更大利润）
  - 盈利达到 +60% → 平仓剩余50%（累计平仓65%）
  - 盈利达到 +100% → 全部清仓（翻倍止盈）

#### 入场条件（AI灵活执行）

- **建议**：多时间框架验证（5m/15m/30m/1h），但AI可根据市场情况灵活调整
- **关键指标**：AI自主选择，可以使用MACD、RSI、EMA等
- **市场状态判断**：单边行情积极参与，震荡行情谨慎入场
- **重视信号质量**：注重质量而非频率

#### AI职责说明

- **完全自主**：自主选择入场时机、杠杆、仓位、止盈止损
- **灵活调整**：根据市场状态动态调整策略
- **主动管理**：AI负责所有开仓和平仓决策
- **自主风控**：根据市场情况自主判断风险

#### 适用场景

- **追求中长期稳健收益**
- **希望AI有充分自主决策权**
- **能接受数小时到24小时的持仓周期**
- **不想被固定策略框架限制**
- **相信AI的分析和学习能力**

#### 配置示例

> **配置文件位置**：`.env` 文件（参考 `.env.example`）

```bash
# 环境变量配置
TRADING_STRATEGY=medium-long
TRADING_INTERVAL_MINUTES=30
MAX_LEVERAGE=25  # 策略固定使用3-10倍
MAX_POSITIONS=5  # 最多5个持仓
INITIAL_BALANCE=2000
```

#### 预期收益

- **月目标收益**：25-50%
- **胜率目标**：根据AI学习情况调整
- **盈亏比目标**：≥2:1（灵活调整）
- **交易风格**：注重质量而非频率

#### 与其他策略对比

| 维度 | 中长线 (medium-long) | 波段趋势 (swing-trend) | AI自主 (ai-autonomous) |
|-----|---------------------|---------------------|---------------------|
| 执行周期 | **30分钟** | 20分钟 | 灵活 |
| 杠杆倍数 | **3-10倍（固定）** | 2-5倍 | 1-最大杠杆 |
| 仓位大小 | **15-35%** | 20-35% | 1-100% |
| 止损幅度 | **-4.5%~-8%** | -5.5%~-9% | AI决定 |
| 持仓时长 | **数小时-24小时** | 数小时-3天 | AI决定 |
| 平仓方式 | **AI主动执行** | 自动监控执行 | 双重防护 |
| 策略指导 | **最小限制** | 明确建议 | 无 |
| 风险等级 | **中** | 中低 | AI决定 |
| 适合行情 | **中长期趋势** | 中期趋势 | 所有行情 |

---

### 稳健策略 (`conservative`)

**核心理念**：保护本金优先，低风险低杠杆

> **配置文件位置**：`src/strategies/conservative.ts`

#### 策略参数
- **杠杆范围**：3-6倍（根据MAX_LEVERAGE的30%-60%）
  - 代码：`leverageMin: Math.max(1, Math.ceil(maxLeverage * 0.3))`
  - 代码：`leverageMax: Math.max(2, Math.ceil(maxLeverage * 0.6))`
  - 注：当MAX_LEVERAGE=10时，实际为3-6倍
- **仓位大小**：15-22%
  - 代码：`positionSizeMin: 15, positionSizeMax: 22`
- **止损范围**：-2.5% ~ -3.5%
  - 代码：`stopLoss: { low: -3.5, mid: -3, high: -2.5 }`

#### 移动止盈
- 盈利≥+6% → 止损移至+2%
  - 代码：`trailingStop.level1: { trigger: 6, stopAt: 2 }`
- 盈利≥+12% → 止损移至+6%
  - 代码：`trailingStop.level2: { trigger: 12, stopAt: 6 }`
- 盈利≥+20% → 止损移至+12%
  - 代码：`trailingStop.level3: { trigger: 20, stopAt: 12 }`

---

### 平衡策略 (`balanced`)

**核心理念**：风险收益平衡，适合大多数投资者

> **配置文件位置**：`src/strategies/balanced.ts`

#### 策略参数
- **杠杆范围**：6-9倍（根据MAX_LEVERAGE的60%-85%）
  - 代码：`leverageMin: Math.max(2, Math.ceil(maxLeverage * 0.6))`
  - 代码：`leverageMax: Math.max(3, Math.ceil(maxLeverage * 0.85))`
  - 注：当MAX_LEVERAGE=10时，实际为6-9倍
- **仓位大小**：20-27%
  - 代码：`positionSizeMin: 20, positionSizeMax: 27`
- **止损范围**：-2% ~ -3%
  - 代码：`stopLoss: { low: -3, mid: -2.5, high: -2 }`

#### 移动止盈
- 盈利≥+8% → 止损移至+3%
  - 代码：`trailingStop.level1: { trigger: 8, stopAt: 3 }`
- 盈利≥+15% → 止损移至+8%
  - 代码：`trailingStop.level2: { trigger: 15, stopAt: 8 }`
- 盈利≥+25% → 止损移至+15%
  - 代码：`trailingStop.level3: { trigger: 25, stopAt: 15 }`

---

### 激进策略 (`aggressive`)

**核心理念**：追求高收益，承担高风险

> **配置文件位置**：`src/strategies/aggressive.ts`

#### 策略参数
- **杠杆范围**：9-10倍（根据MAX_LEVERAGE的85%-100%）
  - 代码：`leverageMin: Math.max(3, Math.ceil(maxLeverage * 0.85))`
  - 代码：`leverageMax: maxLeverage`
  - 注：当MAX_LEVERAGE=10时，实际为9-10倍
- **仓位大小**：25-32%
  - 代码：`positionSizeMin: 25, positionSizeMax: 32`
- **止损范围**：-6% ~ -10%
  - 代码：`stopLoss: { low: -6, mid: -8, high: -10 }`
  - 说明：低杠杆-6%止损，中杠杆-8%止损，高杠杆-10%止损

#### 移动止盈
- 盈利≥+10% → 止损移至+4%
  - 代码：`trailingStop.level1: { trigger: 10, stopAt: 4 }`
- 盈利≥+18% → 止损移至+10%
  - 代码：`trailingStop.level2: { trigger: 18, stopAt: 10 }`
- 盈利≥+30% → 止损移至+18%
  - 代码：`trailingStop.level3: { trigger: 30, stopAt: 18 }`

---

### 激进团策略 (`aggressive-team`)

**核心理念**：团长统筹+4团员专业分析，高杠杆高仓位，震荡识别强化，专业激进不盲目

> **⚠️ 重要提示：Token消耗警告**
> 
> 激进团策略采用多Agent协作模式（1个团长 + 4个团员），每次决策需要调用多个AI模型。
> 
> **成本影响**：
> - Token消耗约为单Agent策略的 **4-5倍**
> - 每个决策周期需要调用5次AI模型（团长1次 + 团员4次）
> - 5分钟执行周期，一天约消耗288次 × 5 = **1440次AI调用**
> 
> **建议**：
> - 仅在充足预算和追求极致收益时使用
> - 可考虑延长执行周期（如10分钟或15分钟）以降低成本
> - 监控API费用，确保在可接受范围内

#### 策略特点

| 配置项 | 参数值 | 说明 |
|-------|--------|------|
| **执行周期** | 15 分钟 | 激进出击，精准捕捉机会 |
| **持仓目标** | 单边行情至少1个 | 单边行情保持持仓（震荡时可空仓） |
| **杠杆范围** | 85%-100% 最大杠杆 | **20倍固定**（已针对优化） |
| **仓位范围** | 25-32% | 大仓位，提升盈利潜力 |
| **止损阈值** | -8%（20倍杠杆） | 严格止损，保护本金 |
| **震荡识别** | **五维30分制强化** | 避免震荡市频繁止损 |
| **风险等级** | 高 | 追求40-60%月回报 |
| **适合人群** | 激进投资者 | 追求极致收益，能承受高风险 |

#### 核心优势

1. **专业团队协作**：
   - 团长（主Agent）：统筹全局，独立分析，最终决策
   - 团员1（趋势分析专家）：K线走势分析，判断单边/震荡
   - 团员2（预测分析专家）：技术指标预测，时间框架验证
   - 团员3（资金流向专家）：成交量、资金费率、订单簿分析
   - 团员4（风险控制专家）：持仓风险评估，仓位杠杆建议

2. **震荡识别强化（30分制）**：
   - 五个维度全面评估震荡风险
   - 低震荡（0-8分）：可开仓
   - 中震荡（10-18分）：谨慎开仓
   - 高震荡（20-30分）：绝对观望

3. **智能优先级规则**：
   ```
   震荡识别 > 持仓数要求 > 激进出击
   ```
   - 高震荡时即使无持仓也不强开
   - 单边行情时至少保持1个持仓，提高盈利机会

4. **针对20倍杠杆优化**：
   - 更严格的止损线：-8%（最多损失本金1.6倍）
   - 更早的移动止盈：15%→8%，30%→20%，50%→35%
   - 更早的分批止盈：30%平30%，50%平50%，80%平100%
   - 更严格的峰值回撤保护：25%

#### 策略参数（针对20倍杠杆优化）

> **配置文件位置**：`src/strategies/aggressiveTeam.ts`

- **执行周期**：5分钟（配置位置：`.env` 文件 `TRADING_INTERVAL_MINUTES=5`）
- **建议持仓时长**：数小时 - 2天
- **杠杆范围**：85%-100% 最大杠杆
  - 代码：`leverageMin: Math.max(3, Math.ceil(maxLeverage * 0.85))`
  - 代码：`leverageMax: maxLeverage`
  - **固定使用20倍杠杆**（已优化所有风控参数）
- **仓位大小**：25-32%
  - 代码：`positionSizeMin: 25, positionSizeMax: 32`
  - 根据信号强度：普通25-28%、良好28-30%、强30-32%

#### 风控配置（20倍杠杆专属）

**止损配置**：
```typescript
stopLoss: {
  low: -12,    // 低杠杆（3-12倍）
  mid: -8,     // 中杠杆（13-21倍）⚠️ 20倍适用
  high: -6,    // 高杠杆（22-30倍）
}
```
- **20倍杠杆使用-8%止损线**
- 相当于最多损失本金的1.6倍（8% × 20 = 160%）

**移动止盈**（更早保护利润）：
```typescript
trailingStop: {
  level1: { trigger: 15, stopAt: 8 },   // 盈利15%时保护至8%
  level2: { trigger: 30, stopAt: 20 },  // 盈利30%时保护至20%
  level3: { trigger: 50, stopAt: 35 },  // 盈利50%时保护至35%
}
```
- 15%盈利 = 本金3倍收益，及时保护
- 30%盈利 = 本金6倍收益，保护大部分利润

**分批止盈**（更早锁定）：
```typescript
partialTakeProfit: {
  stage1: { trigger: 30, closePercent: 30 },  // 盈利30%平30%
  stage2: { trigger: 50, closePercent: 50 },  // 盈利50%平50%
  stage3: { trigger: 80, closePercent: 100 }, // 盈利80%全清
}
```
- 30%盈利（本金6倍）就开始锁定，避免贪婪
- 80%盈利（本金16倍）全部清仓，落袋为安

**峰值回撤保护**：
```typescript
peakDrawdownProtection: 25  // 从峰值回撤25%触发保护
```
- 更严格的回撤保护，防止利润大幅回吐

#### 震荡行情识别强化（五维30分制）

这是激进团避免频繁止损的核心功能！

**维度1：价格形态特征（0-8分）**
- 价格反复穿越EMA20/50
- 价格在固定区间（<3%）内震荡
- 上下影线频繁，实体部分小
- 高低点收敛，形成三角形

**维度2：技术指标混乱（0-8分）**
- MACD频繁金叉死叉
- MACD柱状图在零轴附近震荡
- RSI在40-60之间反复波动
- 布林带收窄（带宽<2%）

**维度3：成交量与价格背离（0-6分）**
- 成交量持续萎缩（比平均量低30%以上）
- 价格突破但成交量不配合
- 成交量忽大忽小，无规律

**维度4：时间框架信号混乱（0-6分）**
- 长周期（30m/1h）与中周期（5m/15m）不一致
- 中周期信号频繁切换
- 短中长周期多空分裂

**维度5：市场情绪中性化（0-6分）**
- 资金费率接近0（-0.001% ~ +0.001%）
- 订单簿买卖单力量接近（差距<10%）
- 4个团员意见分歧（2:2或无明确多数）

**三级震荡预警**：

🟢 **低震荡（0-8分）**：轻微震荡，可谨慎开仓
- 仓位：20-25%
- 杠杆：15-20倍
- 止损：-5%
- 条件：长周期+中周期方向一致

🟡 **中震荡（10-18分）**：明显震荡，高度警惕
- 仓位：15%（最小）
- 杠杆：12-15倍
- 止损：-3%（极紧）
- 条件：4团员全部一致+长中周期完全一致
- 策略：快进快出，获利3-5%立即走

🔴 **高震荡（20-30分）**：严重震荡，绝对禁止开仓！
- 策略：绝对不开新仓，等待震荡结束
- 已有持仓：亏损立即止损，盈利考虑止盈
- 原则：宁可空仓观望，等待趋势明确

#### 持仓数要求与优先级规则

**核心原则**：
```
震荡识别 > 持仓数要求 > 激进出击
```

单边行情时保持至少1个持仓，提高盈利机会，不是为了送钱！

**具体决策逻辑**：

📍 **情况1：持仓≥1个**
- 任何震荡等级：正常按震荡策略执行
- 无冲突，按既定规则操作

📍 **情况2：无持仓 + 🟢低震荡（0-8分）+ 单边行情**
- ✅ 必须开仓，至少持有1个仓位
- 仓位：20-25%，杠杆：15-20倍
- 条件：长周期+中周期方向一致

📍 **情况3：无持仓 + 🟡中震荡（10-18分）**
- ⚠️ 谨慎开仓，仅在极强信号下开仓
- 条件：4团员全部一致 + 长中周期完全一致
- 仓位：15%，杠杆：12-15倍，止损-3%
- 如果不满足：宁可暂时空仓，等待震荡结束

📍 **情况4：无持仓 + 🔴高震荡（20-30分）**
- ❌ 绝对禁止开仓！安全第一！
- 原因：高震荡开仓 = 高概率亏损
- 策略：空仓观望，等待震荡结束（通常1-6小时）
- 补偿：震荡结束且单边行情确认后，立即开仓

#### 团队协作工作流程

1. **团长复盘**：先复盘历史交易和决策，总结经验教训
2. **团长独立分析**：形成初步判断（重点看长周期30m/1h）
3. **并行咨询团员**：使用delegate_task同时调用4个团员
   - 团员1：分析多时间框架走势，判断单边/震荡
   - 团员2：分析技术指标，预测未来走向
   - 团员3：分析资金流向，判断多空力量对比
   - 团员4：评估持仓风险，建议仓位杠杆配置
4. **汇总意见**：团长汇总4个团员的分析报告
5. **输出判断**：团长必须输出【震荡识别】评分和【团长判断】
6. **立即执行**：团长调用交易工具执行决策

**团长判断输出格式**：
```
【震荡识别】（必须先评估！）
- 维度1（价格形态）：X分 | 特征：[具体描述]
- 维度2（技术指标）：X分 | 特征：[具体描述]
- 维度3（成交量）：X分 | 特征：[具体描述]
- 维度4（时间框架）：X分 | 特征：[具体描述]
- 维度5（市场情绪）：X分 | 特征：[具体描述]
- 震荡总分：X/30分 | 震荡等级：🟢低/🟡中/🔴高

【团长判断】
- 长周期趋势：上升/下降/震荡
- 中周期验证：一致/不一致
- 团员意见：一致/分歧
- 信号强度：强/中/弱
- 是否允许开仓：是/否（基于震荡评分）
- 决策：开仓/平仓/观望
```

#### 多时间框架分层判断体系

这是激进团避免频繁止损的关键！

▶ **第一层：长周期趋势确认（30m、1h）【权重：50%】**
- 作用：判断市场主趋势方向和强度
- 必须满足（至少2项）：
  ✓ 价格连续3根K线在EMA20同侧运行
  ✓ MACD柱状图连续同向扩大（至少3根K线）
  ✓ RSI方向明确（做多>55或做空<45）
- ⚠️ 长周期震荡时，必须观望，绝不开仓

▶ **第二层：中周期信号过滤（5m、15m）【权重：30%】**
- 作用：验证长周期趋势是否延续
- 必须满足（至少1项）：
  ✓ 至少1个中周期MACD与长周期方向一致
  ✓ 价格在EMA20同侧运行（与长周期一致）
- ⚠️ 中周期与长周期矛盾 → 信号质量降低，观望或减小仓位

▶ **第三层：短周期入场时机（1m、3m）【权重：20%】**
- 作用：寻找精确入场点，优化入场价格
- 标准：短期回调或突破点
- ⚠️ 短周期信号可优化入场，但绝不能推翻长周期判断

**开仓前必检清单**：
1. ✅ 长周期（30m/1h）趋势明确（非震荡）
2. ✅ 中周期（5m/15m）至少1个与长周期方向一致
3. ✅ 4个团员中至少3个意见一致
4. ✅ 震荡评分<20分（非高震荡）
5. ✅ 当前持仓数<5（系统限制）
6. ✅ 账户余额足够（至少能开25%仓位）

#### 适用场景

**最适合**：
- 追求极致收益，目标月回报40-60%
- 能承受高风险，接受高波动
- 理解20倍杠杆的双刃剑特性
- 相信专业团队协作的力量
- 重视震荡识别，避免盲目交易
- **预算充足，可承担4-5倍token成本**（重要）

**不适合**：
- 风险承受能力低，追求稳健收益
- 无法承受高杠杆的心理压力
- 不信任AI多Agent协作决策
- 市场长期处于震荡状态
- **预算有限，无法承担高额token成本**
- API调用次数受限或成本敏感的用户

#### 配置示例

> **配置文件位置**：`.env` 文件（参考 `.env.example`）

```bash
# 环境变量配置
TRADING_STRATEGY=aggressive-team
TRADING_INTERVAL_MINUTES=15     # 15分钟激进执行
MAX_LEVERAGE=20                  # 固定使用20倍杠杆
MAX_POSITIONS=5                  # 最多5个持仓
INITIAL_BALANCE=2000

# 风控配置
EXTREME_STOP_LOSS_PERCENT=-30
MAX_HOLDING_HOURS=48             # 激进团持仓时间可稍长

# AI模型配置（建议使用高性能模型）
AI_MODEL_NAME=deepseek/deepseek-v3.2-exp
```

#### 预期收益

- **月目标收益**：40-60%（通过专业分析、精准开仓、严格风控）
- **胜率目标**：50-60%（通过震荡识别提高）
- **盈亏比目标**：≥2:1
- **夏普比率**：≥2.0
- **最大回撤**：控制在35%以内

#### 20倍杠杆关键风控点

⚠️ **必须严格遵守**：

1. **止损线-8%绝不违背**：触及必须立即止损
   - 相当于最多损失本金1.6倍
   - 连续3次止损 = 本金接近归零

2. **移动止盈必须执行**：
   - 盈利15%时自动保护至8%（本金3倍收益）
   - 不要贪婪，及时保护利润

3. **分批止盈按计划**：
   - 30%盈利（本金6倍）锁定30%
   - 50%盈利（本金10倍）锁定50%
   - 80%盈利（本金16倍）全部清仓

4. **震荡必须观望**：
   - 高震荡≥20分绝对不开仓
   - 宁可暂时违反持仓数要求
   - 等待震荡结束后再补仓

5. **20倍杠杆提醒**：
   - 5%价格波动 = 100%本金波动
   - 赚得快，亏得也快
   - 严守纪律，止损必执行

#### 与其他激进策略的对比

| 对比项 | 激进团策略 | 激进策略 | 陪审团策略 |
|-------|-----------|---------|-----------|
| 决策模式 | 团长+4团员协作 | 单Agent | 法官+3陪审员 |
| 震荡识别 | **五维30分制强化** | 基础识别 | 基础识别 |
| 杠杆范围 | **20倍固定** | 85%-100%最大 | 14-20倍 |
| 仓位大小 | 25-32% | 25-32% | 18-25% |
| 持仓要求 | **单边行情≥1个** | 无要求 | 无要求 |
| 止损线 | **-8%（20倍专属）** | -6%~-10% | -6%~-8% |
| 移动止盈 | **15%→8%（更早）** | 10%→4% | 10%→4% |
| Token消耗 | **高（5倍）** | 中等 | 较高（4倍） |
| 胜率目标 | **50-60%** | 40-50% | 40-50% |
| 月回报目标 | **40-60%** | 30-50% | 20-35% |

#### 策略代码位置

- 参数配置：`src/strategies/aggressiveTeam.ts` → `getAggressiveTeamStrategy()`
- 提示词生成：`src/strategies/aggressiveTeam.ts` → `generateAggressiveTeamPrompt()`
- 团员Agent：`src/agents/aggressiveTeamAgents.ts`
  - `createAggressiveTeamTrendExpertAgent()` - 趋势分析专家
  - `createAggressiveTeamPredictionExpertAgent()` - 预测分析专家
  - `createAggressiveTeamMoneyFlowExpertAgent()` - 资金流向专家
  - `createAggressiveTeamRiskControlExpertAgent()` - 风险控制专家
- 代码止损：`src/scheduler/stopLossMonitor.ts`
- 代码止盈：`src/scheduler/trailingStopMonitor.ts`
- 分批止盈：`src/scheduler/partialProfitMonitor.ts`

---

### 返佣套利策略 (`rebate-farming`)

**核心理念**：高频微利交易，通过小额稳定盈利和高频交易累积手续费返佣

#### 策略特点

| 配置项 | 参数值 | 说明 |
|-------|--------|------|
| **执行周期** | 5 分钟 | 高频执行，快速捕捉短期价格波动 |
| **持仓时长** | 10-60 分钟 | 短期持仓，微利即走 |
| **杠杆范围** | 40%-60% 最大杠杆 | 如最大25倍，则使用10-15倍（中等杠杆） |
| **仓位范围** | 15-22% | 中小仓位，频繁交易 |
| **止损阈值** | -1.2% 至 -1.8% | 快速止损，不恋战 |
| **止盈策略** | 代码级自动止盈 | 盈利0.8%即触发移动止盈 |
| **风险等级** | 中等 | 单笔风险小，胜率高 |
| **适合人群** | 拥有高额手续费返佣的用户 | 返佣比例50-80% |

#### 盈利模式

```
总收益 = 交易盈利 + 手续费返佣

示例（按10倍杠杆计算）：
- 单笔盈利目标：0.5-1.5%
- 手续费成本：约0.2-0.3%（考虑杠杆）
- 手续费返佣：假设50-80%返佣
- 单笔净利润：0.5-1.5% + 0.1-0.24%返佣 = 0.6-1.74%

月度累积：
- 日均交易：10-30笔
- 月均交易：300-900笔
- 月度盈利：15-25%（交易盈利10-15% + 返佣5-10%）
```

#### 代码级止损配置

```typescript
stopLoss: {
  low: -1.8,   // 低杠杆(5-8倍)：亏损1.8%止损
  mid: -1.5,   // 中杠杆(9-12倍)：亏损1.5%止损
  high: -1.2,  // 高杠杆(13倍+)：亏损1.2%止损
}
```

#### 代码级移动止盈

**核心特点**：极快速锁利，微利即走

```typescript
trailingStop: {
  level1: { trigger: 0.8, stopAt: 0.3 },   // +0.8%触发，回落至+0.3%平仓（保护0.5%空间）
  level2: { trigger: 2, stopAt: 0.8 },     // +2%触发，回落至+0.8%平仓
  level3: { trigger: 4, stopAt: 2 },       // +4%触发，回落至+2%平仓（极少触发）
}
```

**说明**：
- 第一档触发点极低（0.8%），只要覆盖手续费+微利就走
- 不贪心，小确定性盈利优于大不确定性盈利
- 代码自动执行，AI不需要手动平仓

#### 入场规则（严格执行）

**必须同时满足**：
1. ✅ 至少1个长周期（30m或1h）趋势明确（涨或跌）
2. ✅ 至少2个短周期（3m、5m或15m）与长周期方向一致
3. ❌ 长周期震荡时，短周期信号再强也不开仓
4. ❌ 绝不做逆趋势交易

**信号强度评估**：
- 强信号：1长周期趋势 + 3短周期一致 → 15倍杠杆，20-22%仓位
- 良好信号：1长周期趋势 + 2短周期一致 → 12倍杠杆，17-20%仓位
- 普通信号：1长周期趋势 + 2短周期较弱 → 10倍杠杆，15-17%仓位

#### 风控规则

1. **严格止损**：代码自动执行，AI无需担心
2. **拒绝震荡**：长周期震荡时严禁开仓（最大风险）
3. **拒绝逆势**：绝不做逆趋势交易
4. **快速止损**：亏损不恋战，快速换下一个机会
5. **持仓时间**：单笔持仓超过30分钟需谨慎

#### 成功要诀

**✅ 正确做法**：
- 高频微利：单笔0.5-1.5%，单日10-30笔
- 顺势而为：只做顺趋势，拒绝震荡和逆势
- 微利即走：覆盖手续费+小盈利就满足
- 快速止损：保持高胜率
- 返佣收益：高频累积手续费返佣

**❌ 失败根源**：
- 震荡开仓：长周期震荡时频繁开仓 = 频繁止损
- 逆势交易：短期诱惑逆势开仓 = 大概率止损
- 过度贪心：微利不平仓，等待更高目标 = 利润回吐
- 恋战不止损：亏损不愿止损 = 扩大损失

#### 推荐配置

```bash
# .env 配置
TRADING_STRATEGY=rebate-farming
TRADING_INTERVAL_MINUTES=5      # 5分钟执行周期
MAX_LEVERAGE=25                  # 策略会使用10-15倍（40-60%）
MAX_POSITIONS=5                  # 最多5个持仓
```

#### 适用场景

**最适合的市场环境**：
- ✅ 单边趋势行情（涨或跌都可以）
- ✅ 短期波动但长期趋势明确
- ✅ 市场流动性好，滑点小

**不适合的市场环境**：
- ❌ 横盘震荡（长周期无明确趋势）
- ❌ 剧烈波动（止损频繁触发）
- ❌ 流动性差（滑点大，影响盈利）

#### 与超短线策略对比

| 对比项 | 返佣套利策略 | 超短线策略 |
|-------|------------|-----------|
| 执行周期 | 5分钟 | 5分钟 |
| 持仓时长 | 10-60分钟 | 30分钟-2小时 |
| 盈利目标 | 0.5-1.5%（微利） | 2-4%（小利） |
| 杠杆范围 | 10-15倍（中等） | 13-19倍（中高） |
| 止盈触发 | 0.8%（极快） | 4%（较快） |
| 交易频率 | 10-30笔/日（高频） | 10-20笔/日（高频） |
| 止盈方式 | 代码级自动 | AI主动 |
| 收益来源 | 交易盈利 + 返佣 | 交易盈利 |
| 适合人群 | 有高额返佣用户 | 高频交易爱好者 |

#### 策略代码位置

- 参数配置：`src/strategies/rebateFarming.ts` → `getRebateFarmingStrategy()`
- 提示词生成：`src/strategies/rebateFarming.ts` → `generateRebateFarmingPrompt()`
- 代码止损：`src/scheduler/stopLossMonitor.ts`
- 代码止盈：`src/scheduler/trailingStopMonitor.ts`

---

### AI自主策略 (`ai-autonomous`)

**核心理念**：完全由AI主导，不提供任何策略建议，AI自主分析市场并做出所有决策

#### 双重防护机制

AI自主策略是**唯一**采用双重防护模式的策略：

**第一层：代码级自动保护**（每10秒监控，作为安全网）
- 自动止损：
  - 低杠杆（1-5倍）：亏损达到 -8% 自动平仓
  - 中杠杆（6-10倍）：亏损达到 -6% 自动平仓
  - 高杠杆（11倍以上）：亏损达到 -5% 自动平仓
- 自动移动止盈：
  - 盈利达到 5% 时，止损线移至 +2%（锁定利润）
  - 盈利达到 10% 时，止损线移至 +5%（锁定更多利润）
  - 盈利达到 15% 时，止损线移至 +8%（保护大部分利润）
- 自动分批止盈：
  - 盈利达到 8% 时，自动平仓 30%（锁定部分利润）
  - 盈利达到 12% 时，自动平仓 30%（继续锁定利润）
  - 盈利达到 18% 时，自动平仓 40%（大部分获利了结）

**第二层：AI主动决策**（灵活操作权）
- AI可以在代码自动保护触发**之前**主动止损止盈
- AI可以根据市场情况灵活调整，不必等待自动触发
- AI可以更早止损（避免更大亏损）
- AI可以更早止盈（落袋为安）
- 代码保护是最后的安全网，AI有完全的主动权

#### 策略参数

> **配置文件位置**：`src/strategies/aiAutonomous.ts`

- **执行周期**：灵活（建议5-10分钟）
- **杠杆范围**：1-最大杠杆（AI完全自主选择）
- **仓位大小**：1-100%（AI完全自主选择）
- **止损止盈**：双重防护（代码自动 + AI主动）
- **交易频率**：由AI根据市场机会自主决定
- **持仓时长**：由AI根据市场情况自主决定

#### 核心特点

1. **完全自主**：
   - 不提供任何策略建议或限制
   - 只提供市场数据和交易工具
   - AI完全自主分析和决策
   
2. **双重防护**：
   - 代码级监控作为安全网（每10秒自动检查）
   - AI可以主动操作（不受代码监控限制）
   - 提供更强的风险保护和操作灵活性

3. **灵活性最高**：
   - AI自主决定交易策略
   - AI自主决定风险管理
   - AI自主决定仓位和杠杆
   - AI自主决定持仓时间

#### 系统硬性底线

除了双重防护外，还有系统级的最后防线：

- **极端止损**：单笔交易亏损达到 -30% 时，系统会强制平仓（防止爆仓）
- **时间限制**：持仓时间超过 36 小时，系统会强制平仓（释放资金）
- **最大杠杆**：受系统配置限制（如15倍）
- **最大持仓数**：受系统配置限制（如5个）

#### 适用人群

**最适合**：
- 完全信任AI能力的交易者
- 追求最大灵活性和自主性
- 希望有双重保护（代码 + AI）
- 能接受AI完全自主决策
- 不想被策略框架限制

**不适合**：
- 需要明确策略指导的新手
- 希望严格控制风险参数
- 不信任AI自主决策能力
- 需要可预测的交易模式

#### 配置示例

> **配置文件位置**：`.env` 文件（参考 `.env.example`）

```bash
# 环境变量配置
TRADING_STRATEGY=ai-autonomous
TRADING_INTERVAL_MINUTES=5      # 建议5-10分钟
MAX_LEVERAGE=15                  # AI可以使用1-15倍杠杆
MAX_POSITIONS=5                  # 最多5个持仓
INITIAL_BALANCE=2000
```

#### 与其他策略的对比

| 对比项 | AI自主策略 | 其他策略 |
|-------|-----------|---------|
| 策略建议 | 无 | 有明确建议 |
| 杠杆范围 | 1-最大杠杆（AI决定） | 固定范围（如3-5倍） |
| 仓位大小 | 1-100%（AI决定） | 固定范围（如18-25%） |
| 止损方式 | 双重防护 | 代码自动 或 AI主动 |
| 灵活性 | 最高 | 较高 |
| 风险保护 | 最强 | 强 |
| 适合新手 | 否 | 是 |

#### 策略代码位置

- 参数配置：`src/strategies/aiAutonomous.ts` → `getAiAutonomousStrategy()`
- 提示词生成：`src/strategies/aiAutonomous.ts` → `generateAiAutonomousPrompt()`
- 双重防护配置：`enableCodeLevelProtection: true` + `allowAiOverrideProtection: true`
- 代码止损：`src/scheduler/stopLossMonitor.ts`
- 代码止盈：`src/scheduler/trailingStopMonitor.ts`
- 分批止盈：`src/scheduler/partialProfitMonitor.ts`

---

### 陪审团策略 (`multi-agent-consensus`)

**核心理念**：法官与陪审团合议决策，主Agent独立分析+三个专业Agent辅助，追求高质量决策

> **⚠️ 重要提示：Token消耗警告**
> 
> 陪审团策略采用多Agent协作模式（1个主Agent + 3个专业Agent），每次决策都需要调用多个AI模型。
> 
> **成本影响**：
> - Token消耗约为单Agent策略的 **3-4倍**
> - 每个决策周期需要调用4次AI模型（法官1次 + 陪审团3次）
> - 5分钟执行周期，一天约消耗288次 × 4 = **1152次AI调用**
> 
> **建议**：
> - 仅在充足预算和追求极高决策质量时使用
> - 可考虑延长执行周期（如10分钟或15分钟）以降低成本
> - 监控API费用，确保在可接受范围内
> - 预算有限的用户建议使用单Agent策略（如swing-trend、ai-autonomous）

#### 策略参数

> **配置文件位置**：`src/strategies/multiAgentConsensus.ts`

- **执行周期**：5-10分钟（配置位置：`.env` 文件 `TRADING_INTERVAL_MINUTES=5`）
- **建议持仓时长**：数小时 - 数天
- **杠杆范围**：14-20倍（根据MAX_LEVERAGE的55%-80%）
  - 代码：`leverageMin: Math.max(2, Math.ceil(maxLeverage * 0.55))`
  - 代码：`leverageMax: Math.max(3, Math.ceil(maxLeverage * 0.80))`
  - 注：当MAX_LEVERAGE=25时，实际为14-20倍
- **仓位大小**：18-25%
  - 代码：`positionSizeMin: 18, positionSizeMax: 25`
- **止损范围**：-6% ~ -8%
  - 代码：`stopLoss: { low: -6, mid: -7, high: -8 }`

#### 核心优势

1. **多Agent协作决策**：法官（主Agent）+ 三个专业Agent（技术分析、趋势分析、风险评估）
2. **合议制决策**：法官先独立分析，倾听陪审团意见，综合权衡后做出判决
3. **不是简单投票**：权衡各方意见的说服力，而非简单多数表决
4. **双重防护机制**：代码自动监控 + AI主动决策
5. **降低决策偏差**：多视角分析，减少单一Agent的认知盲区

#### 双重防护机制

陪审团策略采用与AI自主策略相同的双重防护模式：

**第一层：代码级自动保护**（每10秒监控，作为安全网）
- **自动止损**：
  - 低杠杆（2-10倍）：亏损达到 -6% 自动平仓
  - 中杠杆（11-15倍）：亏损达到 -7% 自动平仓
  - 高杠杆（16倍以上）：亏损达到 -8% 自动平仓
- **自动移动止盈**：
  - 盈利达到 +10% 时，止损线移至 +4%（锁定利润）
  - 盈利达到 +18% 时，止损线移至 +10%（锁定更多利润）
  - 盈利达到 +28% 时，止损线移至 +18%（保护大部分利润）
- **自动分批止盈**：
  - 盈利达到 +25% 时，自动平仓 40%（锁定部分利润）
  - 盈利达到 +35% 时，自动平仓 40%（继续锁定利润）
  - 盈利达到 +45% 时，自动平仓 100%（全部获利了结）

**第二层：AI主动决策**（灵活操作权）
- 法官可以在代码自动保护触发**之前**主动止损止盈
- 法官可以根据市场情况灵活调整，不必等待自动触发
- 法官可以更早止损（避免更大亏损）
- 法官可以更早止盈（落袋为安）
- 代码保护是最后的安全网，法官有完全的主动权

#### 陪审团成员

1. **技术分析Agent**：分析技术指标（MACD、RSI、布林带等）
2. **趋势分析Agent**：分析多时间框架趋势（1m/3m/5m/15m/1h/4h）
3. **风险评估Agent**：评估市场风险和持仓风险

#### 工作流程

1. **法官独立分析**：法官先独立分析市场，形成初步判断
2. **咨询陪审团**：使用`delegate_task`工具调用三个专业Agent
3. **收集意见**：汇总三个Agent的分析意见和建议
4. **合议决策**：法官综合所有意见（包括自己的判断）做出最终决策
5. **执行决策**：法官执行开仓/平仓/观望操作（只有法官能执行交易）

#### 入场条件（法官执行）

- **必须获得陪审团意见**：至少咨询技术分析、趋势分析、风险评估三个Agent
- **综合判断**：不是简单的多数表决，而是权衡各方意见的说服力
- **信号强度分级**：
  - 普通信号：18-20%仓位，14倍杠杆
  - 良好信号：20-23%仓位，17倍杠杆
  - 强信号：23-25%仓位，20倍杠杆
- **紧急情况**：持仓亏损接近止损线时，法官可跳过陪审团直接决策

#### 适用场景

**最适合**：
- 追求稳健决策，重视风险控制
- 希望通过多视角分析降低决策偏差
- 能接受数小时到数天的持仓周期
- 不急于频繁交易，追求高质量信号
- 希望有双重保护（代码 + AI）

**不适合**：
- 追求极高频交易（陪审团决策需要时间）
- 市场波动极快，需要秒级决策
- 不喜欢复杂的决策流程
- **预算有限，无法承担3-4倍token成本**
- API调用次数受限或成本敏感的用户

#### 配置示例

> **配置文件位置**：`.env` 文件（参考 `.env.example`）

```bash
# 环境变量配置
TRADING_STRATEGY=multi-agent-consensus
TRADING_INTERVAL_MINUTES=5      # 建议5-10分钟
MAX_LEVERAGE=25                  # 策略使用14-20倍（55%-80%）
MAX_POSITIONS=3                  # 最多3个持仓（谨慎入场）
INITIAL_BALANCE=2000
```

#### 预期收益

- **月目标收益**：20-35%
- **胜率目标**：40-50%（通过多Agent决策提高胜率）
- **盈亏比目标**：≥2.5:1
- **夏普比率**：≥1.8

#### 与其他策略的对比

| 对比项 | 陪审团策略 | AI自主策略 | 波段趋势策略 |
|-------|-----------|-----------|-------------|
| 决策模式 | 法官+陪审团合议 | AI完全自主 | AI开仓+自动监控 |
| 杠杆范围 | 14-20倍 | 1-最大杠杆 | 2-5倍 |
| 仓位大小 | 18-25% | 1-100% | 20-35% |
| 止损方式 | 双重防护 | 双重防护 | 自动监控 |
| 决策时间 | 较长（需咨询） | 灵活 | 中等 |
| Token消耗 | 较高（多Agent） | 中等 | 中等 |
| 胜率目标 | 40-50% | AI决定 | 35-45% |
| 适合新手 | 是 | 否 | 是 |

#### 策略代码位置

- 参数配置：`src/strategies/multiAgentConsensus.ts` → `getMultiAgentConsensusStrategy()`
- 提示词生成：`src/strategies/multiAgentConsensus.ts` → `generateMultiAgentConsensusPrompt()`
- 双重防护配置：`enableCodeLevelProtection: true` + `allowAiOverrideProtection: true`
- 代码止损：`src/scheduler/stopLossMonitor.ts`
- 代码止盈：`src/scheduler/trailingStopMonitor.ts`
- 分批止盈：`src/scheduler/partialProfitMonitor.ts`

---

### Alpha Beta 策略 (`alpha-beta`)

**核心理念**：零策略指导，AI完全自主决策，强制自我复盘，持续学习优化

#### 策略参数

> **配置文件位置**：`src/strategies/alphaBeta.ts`

- **执行周期**：灵活（建议5-10分钟）
- **杠杆范围**：1-最大杠杆（AI完全自主选择）
  - 代码：`leverageMin: 1, leverageMax: maxLeverage`
- **仓位大小**：1-100%（AI完全自主选择）
  - 代码：`positionSizeMin: 1, positionSizeMax: 100`
- **止损止盈**：双重防护（代码自动 + AI主动）
- **交易频率**：由AI根据市场机会自主决定
- **持仓时长**：由AI根据市场情况自主决定

#### 核心特点

1. **零策略指导**：
   - 不提供任何策略建议或限制
   - 只提供市场数据和交易工具
   - AI完全自主分析和决策
   
2. **强制自我复盘机制**（核心特色）：
   - 每个交易周期必须先进行自我复盘
   - 分析最近盈亏交易的得失
   - 识别改进空间，制定改进计划
   - 从历史中学习，持续优化
   
3. **双重防护机制**：
   - 代码级自动保护（每10秒自动检查）
   - AI可以主动操作（不受代码监控限制）
   - 提供更强的风险保护和操作灵活性

4. **完全自主权**：
   - AI自主决定所有交易参数
   - AI自主制定交易策略
   - AI自主管理风险
   - AI自主学习和优化

#### 双重防护机制

Alpha Beta策略采用最强的双重防护模式：

**第一层：代码级自动保护**（每10秒监控，作为安全网）

- **自动止损**：
  - 低杠杆（1-5倍）：亏损达到 -8% 自动平仓
  - 中杠杆（6-10倍）：亏损达到 -6% 自动平仓
  - 高杠杆（11倍以上）：亏损达到 -5% 自动平仓

- **自动移动止盈**：
  - 盈利达到 5% 时，止损线移至 +2%
  - 盈利达到 10% 时，止损线移至 +5%
  - 盈利达到 15% 时，止损线移至 +10%

- **自动分批止盈**：
  - 盈利达到 20% 时，自动平仓 30%
  - 盈利达到 30% 时，自动平仓 30%
  - 盈利达到 40% 时，自动平仓 100%

**第二层：AI主动决策**（灵活操作权）

- AI可以在代码自动保护触发**之前**主动止损止盈
- AI可以根据市场情况灵活调整，不必等待自动触发
- AI可以更早止损（避免更大亏损）
- AI可以更早止盈（落袋为安）
- 代码保护是最后的安全网，AI有完全的主动权

#### 强制自我复盘机制（核心特色）

每个交易周期，AI **必须先进行自我复盘**，然后再做交易决策。

**复盘四步骤**：

1. **回顾最近交易表现**：
   - 分析盈利交易：什么做对了？
   - 分析亏损交易：什么做错了？
   - 当前胜率如何？

2. **评估当前策略有效性**：
   - 当前策略是否适应市场环境？
   - 杠杆和仓位管理是否合理？
   - 是否存在重复犯错的模式？

3. **识别改进空间**：
   - 哪些方面可以做得更好？
   - 是否需要调整风险管理方式？
   - 是否需要改变交易频率？

4. **制定改进计划**：
   - 基于复盘结果调整策略
   - 避免之前犯过的错误
   - 如何提高交易质量和胜率

**复盘输出格式**（强制遵守）：

```
【自我复盘】
- 最近交易回顾：（分析盈利和亏损交易）
- 策略有效性评估：（当前策略是否适应市场）
- 改进空间识别：（发现可改进的地方）
- 本次改进计划：（具体的改进措施）

【本次交易决策】
（基于复盘结果做出的交易决策）
```

#### 系统硬性底线

- **极端止损**：单笔交易亏损达到 -30% 时，系统会强制平仓
- **时间限制**：持仓时间超过 36 小时，系统会强制平仓
- **最大杠杆**：受系统配置限制（如15倍）
- **最大持仓数**：受系统配置限制（如5个）

#### 适用人群

**最适合**：
- 完全信任AI能力的交易者
- 追求最大灵活性和自主性
- 重视从历史中学习和持续优化
- 希望有双重保护（代码 + AI）
- 能接受AI完全自主决策
- 不想被任何策略框架限制

**不适合**：
- 需要明确策略指导的新手
- 希望严格控制风险参数
- 不信任AI自主决策能力
- 需要可预测的交易模式

#### 配置示例

> **配置文件位置**：`.env` 文件（参考 `.env.example`）

```bash
# 环境变量配置
TRADING_STRATEGY=alpha-beta
TRADING_INTERVAL_MINUTES=5      # 建议5-10分钟
MAX_LEVERAGE=15                  # AI可以使用1-15倍杠杆
MAX_POSITIONS=5                  # 最多5个持仓
INITIAL_BALANCE=2000
```

#### 与其他策略的对比

| 对比项 | Alpha Beta | AI自主 | 中长线 |
|-------|-----------|---------|--------|
| 策略指导 | **零（完全自主）** | 无 | 最小限制 |
| 强制复盘 | **是（核心特色）** | 否 | 否 |
| 杠杆范围 | 1-最大杠杆 | 1-最大杠杆 | 3-10倍 |
| 仓位大小 | 1-100% | 1-100% | 15-35% |
| 止损方式 | 双重防护 | 双重防护 | AI主动 |
| 学习机制 | **强制自我复盘** | 被动学习 | 被动学习 |
| 灵活性 | **最高** | 最高 | 高 |
| 风险保护 | **最强** | 最强 | 强 |
| 适合新手 | 否 | 否 | 否 |

#### 核心优势

**与AI自主策略的主要区别**：

1. **强制自我复盘**：Alpha Beta强制AI每次都要先复盘再决策
2. **持续学习优化**：通过复盘机制持续改进交易策略
3. **零策略干扰**：完全不提供任何策略建议，让AI真正自主
4. **记录推理过程**：所有决策过程都会被记录和分析

**适用场景**：

- 希望AI具备自我学习和进化能力
- 相信强制复盘能提高决策质量
- 追求长期持续优化的交易系统
- 愿意给AI充分的试错和学习空间

#### 策略代码位置

- 参数配置：`src/strategies/alphaBeta.ts` → `getAlphaBetaStrategy()`
- 提示词生成：`src/strategies/alphaBeta.ts` → `generateAlphaBetaPrompt()`
- 双重防护配置：`enableCodeLevelProtection: true` + `allowAiOverrideProtection: true`
- 代码止损：`src/scheduler/stopLossMonitor.ts`
- 代码止盈：`src/scheduler/trailingStopMonitor.ts`
- 分批止盈：`src/scheduler/partialProfitMonitor.ts`

---

## 策略切换指南

### 波段趋势策略使用场景

**适合场景**：
- 希望系统自动化执行止损止盈，减少人为干预
- 追求更稳定的自动化交易体验
- 能接受数小时到数天的持仓周期
- 资金规模较大，重视风险控制
- 希望AI专注于开仓决策，不操心平仓

**不适合场景**：
- 市场处于震荡盘整，无明确趋势
- 你需要完全手动控制平仓时机
- 你无法接受数天的持仓周期

### 超短线策略使用场景

**适合场景**：
- 市场波动频繁，短期趋势明确
- 你有充足时间监控系统
- 你喜欢快进快出的交易节奏
- 资金规模较小，需要快速积累

### 返佣套利策略使用场景

**适合场景**：
- 你拥有高额手续费返佣（50-80%）
- 追求高频交易，通过频次累积收益
- 能接受短期持仓（10-60分钟）
- 希望系统自动化止损止盈（代码级控制）
- 市场有明确趋势（涨或跌都可以）
- 不贪心，满足微利即走（0.5-1.5%）

**不适合场景**：
- 没有手续费返佣或返佣比例很低
- 市场处于横盘震荡，无明确趋势
- 追求单笔大盈利，不满足小利
- 无法接受高频交易（日均10-30笔）
- 市场流动性差，滑点大

**与超短线策略的选择**：
- 有高额返佣 → 选择返佣套利策略（更高频，更小目标）
- 无返佣或低返佣 → 选择超短线策略（频率稍低，盈利目标更高）

### 陪审团策略使用场景

**适合场景**：
- 追求稳健决策，重视风险控制
- 希望通过多Agent协作降低决策偏差
- 能接受数小时到数天的持仓周期
- 不急于频繁交易，追求高质量信号
- 希望有双重保护（代码自动 + AI主动）
- **预算充足，可承担3-4倍token成本**（重要）
- API调用无严格限制

**不适合场景**：
- 追求极高频交易（陪审团决策需要时间）
- 市场波动极快，需要秒级决策
- 不喜欢复杂的决策流程
- 系统资源有限，无法承担多Agent的成本
- 需要极简决策流程

**与其他策略的选择**：
- 追求稳健决策 + 多视角分析 → 选择陪审团策略
- 追求AI完全自主 + 最大灵活性 → 选择AI自主策略
- 追求自动化保护 + 趋势持仓 → 选择波段趋势策略

### 激进团策略使用场景

**适合场景**：
- 追求极致收益，目标月回报40-60%
- 能承受高风险和高波动（20倍杠杆）
- 相信专业团队协作（团长+4团员）决策
- 重视震荡识别，避免频繁止损
- 希望在单边行情中全力进攻
- 能接受激进但不盲目的交易风格
- **预算充足，可承担4-5倍token成本**（重要）

**不适合场景**：
- 风险承受能力低，追求稳健收益
- 无法承受20倍杠杆的心理压力
- 不信任AI多Agent协作决策
- 市场长期处于横盘震荡状态
- **预算有限，无法承担高额token成本**
- API调用次数受限的用户

**与其他策略的选择**：
- 追求极致收益 + 专业团队协作 + 震荡识别 → 选择激进团策略
- 追求高收益 + 单Agent决策 → 选择激进策略
- 追求稳健决策 + 多Agent合议 → 选择陪审团策略
- 追求AI完全自主 + 最大灵活性 → 选择AI自主策略

### 中长线策略使用场景

**适合场景**：
- 追求中长期稳健收益（月目标25-50%）
- 希望AI有充分自主决策权
- 能接受数小时到24小时的持仓周期
- 不想被固定策略框架限制
- 相信AI的分析和学习能力
- 追求较长的交易周期（30分钟）
- 希望注重质量而非频率

**不适合场景**：
- 需要明确策略指导的新手
- 喜欢高频交易
- 无法接受较长的持仓周期
- 希望有严格的策略框架

**与其他策略的选择**：
- AI主导决策 + 中长期持仓 → 选择中长线策略
- 自动监控 + 中期趋势 → 选择波段趋势策略
- 完全自主 + 任意周期 → 选择AI自主或Alpha Beta策略

### Alpha Beta策略使用场景

**适合场景**：
- 完全信任AI能力的交易者
- 追求最大灵活性和自主性
- 重视从历史中学习和持续优化
- 相信强制复盘能提高决策质量
- 希望AI具备自我学习和进化能力
- 愿意给AI充分的试错和学习空间
- 追求长期持续优化的交易系统
- 希望有双重保护（代码 + AI）

**不适合场景**：
- 需要明确策略指导的新手
- 希望严格控制风险参数
- 不信任AI自主决策能力
- 需要可预测的交易模式
- 不想AI进行自我复盘

**与其他策略的选择**：
- 零策略指导 + 强制复盘 + 持续学习 → 选择Alpha Beta策略
- AI完全自主 + 无复盘机制 → 选择AI自主策略
- AI主导 + 最小限制 + 无复盘 → 选择中长线策略

### 策略切换步骤

> **配置文件位置**：`.env` 文件（参考 `.env.example`）

1. **平仓所有持仓**（避免策略冲突）
2. **修改环境变量**：
   ```bash
   # 切换到波段趋势策略
   TRADING_STRATEGY=swing-trend
   TRADING_INTERVAL_MINUTES=20
   
   # 或切换到超短线策略
   TRADING_STRATEGY=ultra-short
   TRADING_INTERVAL_MINUTES=5
   
   # 或切换到激进团策略
   TRADING_STRATEGY=aggressive-team
   TRADING_INTERVAL_MINUTES=15
   MAX_LEVERAGE=20  # 固定使用20倍杠杆
   
   # 或切换到返佣套利策略
   TRADING_STRATEGY=rebate-farming
   TRADING_INTERVAL_MINUTES=5
   
   # 或切换到AI自主策略
   TRADING_STRATEGY=ai-autonomous
   TRADING_INTERVAL_MINUTES=5
   
   # 或切换到陪审团策略
   TRADING_STRATEGY=multi-agent-consensus
   TRADING_INTERVAL_MINUTES=5
   
   # 或切换到中长线策略
   TRADING_STRATEGY=medium-long
   TRADING_INTERVAL_MINUTES=30
   MAX_LEVERAGE=25  # 策略固定使用3-10倍
   
   # 或切换到Alpha Beta策略
   TRADING_STRATEGY=alpha-beta
   TRADING_INTERVAL_MINUTES=5
   MAX_LEVERAGE=15  # AI可以使用1-15倍
   ```
3. **重启系统**：
   ```bash
   docker-compose down
   docker-compose up -d
   ```

---

## 风控对比

### 系统硬性底线（所有策略共同）

> **配置文件位置**：
> - 代码实现：`src/config/riskParams.ts`
> - 环境变量：`.env` 文件

- **极端止损**：单笔亏损≤-30%强制平仓（防止爆仓）
  - 环境变量：`EXTREME_STOP_LOSS_PERCENT=-30`
  - 代码：`RISK_PARAMS.EXTREME_STOP_LOSS_PERCENT`
- **36小时限制**：任何持仓超过36小时强制平仓（释放资金）
  - 环境变量：`MAX_HOLDING_HOURS=36`
  - 代码：`RISK_PARAMS.MAX_HOLDING_HOURS`
- **账户回撤保护**：账户总回撤达到预设阈值时触发保护
  - 警告阈值：`ACCOUNT_DRAWDOWN_WARNING_PERCENT=20`
  - 禁止开仓：`ACCOUNT_DRAWDOWN_NO_NEW_POSITION_PERCENT=30`
  - 强制平仓：`ACCOUNT_DRAWDOWN_FORCE_CLOSE_PERCENT=50`

### 策略专属风控

| 策略 | 专属风控规则 | 特点 |
|-----|-------------|-----|
| ultra-short | 2%周期锁利、30分钟盈利平仓 | 系统**强制执行** |
| swing-trend | 自动监控止损（每10秒）、自动监控移动止盈（每10秒，5级规则） | 系统**自动执行**，AI不干预 |
| rebate-farming | 自动监控止损（每10秒）、自动监控移动止盈（每10秒） | 系统**自动执行**，AI不干预 |
| aggressive | 自动监控止损（每10秒）、自动监控移动止盈（每10秒） | 系统**自动执行**，AI不干预 |
| **ai-autonomous** | **双重防护：代码自动监控 + AI主动决策** | **双重防护策略** |
| **multi-agent-consensus** | **双重防护：代码自动监控 + 法官主动决策** | **双重防护策略** |
| conservative/balanced | 无专属规则 | AI全权决策 |

---

## 最佳实践建议

### 波段趋势策略最佳实践

1. **耐心等待信号**
   - 等待1m/3m/5m/15m这4个时间框架全部共振
   - 确保MACD、RSI、EMA方向一致
   - 不要急于开仓，质量优于数量

2. **信任自动监控**
   - 自动监控系统每10秒检查一次
   - 止损和止盈会自动执行，无需AI干预
   - AI专注于寻找高质量开仓机会

3. **合理使用仓位**
   - 普通信号：20-25%仓位
   - 良好信号：25-30%仓位
   - 强信号：30-35%仓位（谨慎使用）

4. **合理使用杠杆**
   - 普通信号：2倍杠杆（最安全）
   - 良好信号：3倍杠杆（平衡）
   - 强信号：5倍杠杆（最大值，谨慎使用）

5. **控制同时持仓数**
   - 建议：1-3个持仓（`MAX_POSITIONS=3`）
   - 避免过度分散，保持资金集中度

6. **理解自动化保护**
   - 止损：触及止损线立即自动平仓
   - 止盈：峰值回撤达标立即自动平仓
   - AI只需要在报告中说明持仓状态即可

### 超短线策略最佳实践

1. **快进快出**
   - 盈利>2%立即考虑锁利
   - 不要贪婪，小利润也是利润

2. **严格遵守规则**
   - 系统的2%锁利和30分钟规则是经验总结
   - 不要试图手动干预

3. **高频监控**
   - 5分钟周期需要更频繁的监控
   - 确保系统稳定运行

### 陪审团策略最佳实践

1. **遵循合议流程**
   - 法官先独立分析，形成初步判断
   - 必须咨询三个专业Agent的意见
   - 综合权衡后做出最终决策
   - 不要跳过陪审团直接决策（除非紧急情况）

2. **合理使用仓位和杠杆**
   - 普通信号：18-20%仓位，14倍杠杆（最保守）
   - 良好信号：20-23%仓位，17倍杠杆（平衡）
   - 强信号：23-25%仓位，20倍杠杆（最大值，谨慎使用）

3. **重视决策质量**
   - 不是简单的多数表决，要权衡各方意见的说服力
   - 如果三个Agent意见分歧很大，说明市场信号不明确，建议观望
   - 只在高质量信号时交易，追求高胜率而非高频率

4. **控制持仓数量**
   - 建议：1-3个持仓（`MAX_POSITIONS=3`）
   - 多Agent决策需要时间，持仓过多会增加决策负担
   - 保持资金集中度，提高决策效率

5. **信任双重防护**
   - 代码自动监控是安全网，会在关键时刻自动保护
   - 法官有主动权，可以在代码触发之前主动止损止盈
   - 紧急情况下可跳过陪审团直接决策

6. **管理token消耗（重要）**
   - 多Agent协作会消耗约3-4倍的token成本
   - 在delegate_task中只传递简短的任务描述，避免冗长内容
   - 不要在task中重复传递市场数据（子Agent已有市场数据上下文）
   - 定期监控API费用，确保在预算范围内
   - 考虑使用成本更低的AI模型（如DeepSeek替代GPT-4）
   - 可适当延长执行周期（5分钟→10分钟）以降低调用频率

---

## 配置示例

> **配置文件位置**：
> - 主配置：`.env` 文件（参考 `.env.example` 模板）
> - 策略实现：`src/strategies/` 目录
> - 风控参数：`src/config/riskParams.ts`

### 测试环境配置 - 波段趋势策略示例

**⚠️ 强烈建议使用测试网进行策略测试，避免真实资金损失**

```bash
# .env 文件配置

# ============================================
# 服务器配置
# ============================================
PORT=3100

# ============================================
# 交易配置
# ============================================
# 策略配置
TRADING_STRATEGY=swing-trend           # 使用波段趋势策略
TRADING_INTERVAL_MINUTES=20            # 20分钟执行周期

# 风控配置
MAX_LEVERAGE=25                        # 最大杠杆25倍（策略实际使用2-5倍）
MAX_POSITIONS=5                        # 最多5个持仓
MAX_HOLDING_HOURS=36                   # 最大持仓36小时
EXTREME_STOP_LOSS_PERCENT=-30          # 极端止损-30%
INITIAL_BALANCE=1000                   # 初始资金1000 USDT

# 账户风控
ACCOUNT_STOP_LOSS_USDT=50              # 账户止损线
ACCOUNT_TAKE_PROFIT_USDT=20000         # 账户止盈线
SYNC_CONFIG_ON_STARTUP=true            # 启动时同步配置

# ============================================
# 数据库配置
# ============================================
DATABASE_URL=file:./.voltagent/trading.db

# ============================================
# Gate.io API 配置
# ============================================
GATE_API_KEY=your_api_key_here
GATE_API_SECRET=your_api_secret_here
GATE_USE_TESTNET=true                  # 使用测试网（推荐）

# ============================================
# AI 模型配置
# ============================================
OPENAI_API_KEY=your_api_key_here
OPENAI_BASE_URL=https://openrouter.ai/api/v1
AI_MODEL_NAME=deepseek/deepseek-v3.2-exp

# ============================================
# 账户回撤风控配置
# ============================================
ACCOUNT_DRAWDOWN_WARNING_PERCENT=20          # 警告阈值
ACCOUNT_DRAWDOWN_NO_NEW_POSITION_PERCENT=30  # 禁止开仓阈值
ACCOUNT_DRAWDOWN_FORCE_CLOSE_PERCENT=50      # 强制平仓阈值

# ============================================
# 账户记录配置
# ============================================
ACCOUNT_RECORD_INTERVAL_MINUTES=1            # 账户记录间隔
```

### 测试环境配置 - 超短线策略示例

**⚠️ 强烈建议使用测试网进行策略测试，避免真实资金损失**

```bash
# .env 文件配置

# ============================================
# 交易配置
# ============================================
TRADING_STRATEGY=ultra-short           # 使用超短线策略
TRADING_INTERVAL_MINUTES=5             # 5分钟执行周期

# 风控配置
MAX_LEVERAGE=25
MAX_POSITIONS=5                        # 超短线可以持仓更多
MAX_HOLDING_HOURS=36
INITIAL_BALANCE=1000                   # 测试环境小资金

# Gate.io API 配置
GATE_USE_TESTNET=true                  # 使用测试网（推荐）

# 其他配置参照波段策略示例
```

---

## 常见问题

### Q1: 波段策略的AI为什么不主动平仓？
**A**: 为了实现更稳定和一致的风控执行。自动监控系统每10秒检查一次，触发条件立即平仓，比AI的20分钟执行周期更及时。AI专注于寻找高质量开仓机会，平仓交给自动监控系统处理，实现职责分离，效率更高。

### Q2: 自动监控会不会过早平仓？
**A**: 自动监控使用5级移动止盈规则，会根据盈利峰值动态调整。例如峰值10%时回退2.5%才平仓，既保护了利润（保底7.5%），又给趋势足够空间。这个平衡经过精心设计。

### Q3: 为什么波段策略使用1m/3m/5m/15m短周期？
**A**: 虽然叫"波段"，但入场时机需要精准。短周期组合（1-15分钟）能更快捕捉趋势形成的早期信号，避免使用4小时等长周期导致的滞后。持仓时间依然可达数天，让利润充分奔跑。

### Q4: 仓位20-35%会不会太大？
**A**: 这取决于信号强度。强信号（4个时间框架完美共振+技术指标极度一致）才使用30-35%，普通信号只用20-25%。配合2-5倍低杠杆和严格的自动监控止损，风险是可控的。

### Q5: 可以同时运行多个策略吗？
**A**: 不建议。每个策略有不同的风控规则和执行逻辑，同时运行可能导致冲突。建议根据市场状况选择一个策略专注执行。

### Q6: 如何评估策略效果？
**A**: 关注这些指标：
- **胜率**：盈利交易占比（波段策略目标35-45%）
- **盈亏比**：平均盈利/平均亏损（目标≥2:1）
- **月收益率**：月度总收益（波段策略目标20-35%）
- **夏普比率**：风险调整后收益（目标≥1.5）
- **最大回撤**：峰值到低谷的最大跌幅（控制在20%以内）
- **止损及时性**：自动监控的反应速度（10秒检查）

---

## 技术支持

如有问题或建议，请通过以下方式联系：

- **GitHub Issues**: [https://github.com/195440/open-nof1.ai/issues](https://github.com/195440/open-nof1.ai/issues)
- **讨论区**: [https://github.com/195440/open-nof1.ai/discussions](https://github.com/195440/open-nof1.ai/discussions)

---

## 技术实现

> **核心文件位置**：
> - 策略模块：`src/strategies/` 目录
> - 策略统一导出：`src/strategies/index.ts`
> - 策略类型定义：`src/strategies/types.ts`
> - 交易代理：`src/agents/tradingAgent.ts`
> - 风控参数：`src/config/riskParams.ts`
> - 交易循环：`src/scheduler/tradingLoop.ts`

所有策略的实现遵循统一的架构模式：

1. **策略参数定义**：每个策略在对应的 `.ts` 文件中定义了完整的参数配置，包括杠杆范围、仓位大小、止损范围等
   - 超短线：`src/strategies/ultraShort.ts` → `getUltraShortStrategy()`
   - 波段趋势：`src/strategies/swingTrend.ts` → `getSwingTrendStrategy()`
   - **中长线**：`src/strategies/mediumLong.ts` → `getMediumLongStrategy()`
   - 稳健策略：`src/strategies/conservative.ts` → `getConservativeStrategy()`
   - 平衡策略：`src/strategies/balanced.ts` → `getBalancedStrategy()`
   - 激进策略：`src/strategies/aggressive.ts` → `getAggressiveStrategy()`
   - **激进团策略**：`src/strategies/aggressiveTeam.ts` → `getAggressiveTeamStrategy()`
   - 返佣套利：`src/strategies/rebateFarming.ts` → `getRebateFarmingStrategy()`
   - AI自主：`src/strategies/aiAutonomous.ts` → `getAiAutonomousStrategy()`
   - 陪审团：`src/strategies/multiAgentConsensus.ts` → `getMultiAgentConsensusStrategy()`
   - **Alpha Beta**：`src/strategies/alphaBeta.ts` → `getAlphaBetaStrategy()`

2. **提示词生成**：每个策略文件包含 `generateXxxPrompt()` 函数，为 AI 生成特定于该策略的决策提示词
   - 超短线：`generateUltraShortPrompt()`
   - 波段趋势：`generateSwingTrendPrompt()`
   - **中长线**：`generateMediumLongPrompt()`
   - 稳健策略：`generateConservativePrompt()`
   - 平衡策略：`generateBalancedPrompt()`
   - 激进策略：`generateAggressivePrompt()`
   - **激进团策略**：`generateAggressiveTeamPrompt()`
   - 返佣套利：`generateRebateFarmingPrompt()`
   - AI自主：`generateAiAutonomousPrompt()`
   - 陪审团：`generateMultiAgentConsensusPrompt()`
   - **Alpha Beta**：`generateAlphaBetaPrompt()`

3. **多Agent协作**（激进团和陪审团专属）：
   - 激进团团员：`src/agents/aggressiveTeamAgents.ts`
     - `createAggressiveTeamTrendExpertAgent()` - 趋势分析专家
     - `createAggressiveTeamPredictionExpertAgent()` - 预测分析专家
     - `createAggressiveTeamMoneyFlowExpertAgent()` - 资金流向专家
     - `createAggressiveTeamRiskControlExpertAgent()` - 风险控制专家
   - 陪审团成员：`src/agents/analysisAgents.ts`
     - `createTechnicalAnalysisAgent()` - 技术分析Agent
     - `createTrendAnalysisAgent()` - 趋势分析Agent
     - `createRiskAssessmentAgent()` - 风险评估Agent

4. **统一导出**：通过 `src/strategies/index.ts` 统一导出所有策略，方便系统调用

### 策略选择逻辑

> **实现文件**：`src/strategies/index.ts`

系统根据环境变量 `TRADING_STRATEGY` 动态加载对应策略：

```typescript
// 在 src/strategies/index.ts 中
export function getStrategyParams(strategy: TradingStrategy, maxLeverage: number): StrategyParams {
  switch (strategy) {
    case "ultra-short":
      return getUltraShortStrategy(maxLeverage);
    case "swing-trend":
      return getSwingTrendStrategy(maxLeverage);
    case "medium-long":
      return getMediumLongStrategy(maxLeverage);  // 中长线策略
    case "conservative":
      return getConservativeStrategy(maxLeverage);
    case "balanced":
      return getBalancedStrategy(maxLeverage);
    case "aggressive":
      return getAggressiveStrategy(maxLeverage);
    case "aggressive-team":
      return getAggressiveTeamStrategy(maxLeverage);
    case "rebate-farming":
      return getRebateFarmingStrategy(maxLeverage);
    case "ai-autonomous":
      return getAiAutonomousStrategy(maxLeverage);
    case "multi-agent-consensus":
      return getMultiAgentConsensusStrategy(maxLeverage);
    case "alpha-beta":
      return getAlphaBetaStrategy(maxLeverage);  // Alpha Beta策略
    default:
      return getAiAutonomousStrategy(maxLeverage);
  }
}
```

### 配置项与代码对照表

| 配置项 | 环境变量 | 代码位置 | 说明 |
|-------|---------|---------|------|
| 交易策略 | `TRADING_STRATEGY` | `src/strategies/index.ts` | 策略选择逻辑 |
| 执行周期 | `TRADING_INTERVAL_MINUTES` | `src/scheduler/tradingLoop.ts` | 交易循环间隔 |
| 最大杠杆 | `MAX_LEVERAGE` | `.env` → 各策略文件 | 策略基准值 |
| 最大持仓数 | `MAX_POSITIONS` | `src/config/riskParams.ts` | 风控参数 |
| 最大持仓时长 | `MAX_HOLDING_HOURS` | `src/config/riskParams.ts` | 风控参数 |
| 极端止损 | `EXTREME_STOP_LOSS_PERCENT` | `src/config/riskParams.ts` | 风控参数 |
| 初始资金 | `INITIAL_BALANCE` | `src/config/riskParams.ts` | 资金管理 |
| 账户回撤警告 | `ACCOUNT_DRAWDOWN_WARNING_PERCENT` | `src/config/riskParams.ts` | 风控参数 |
| 账户回撤禁止开仓 | `ACCOUNT_DRAWDOWN_NO_NEW_POSITION_PERCENT` | `src/config/riskParams.ts` | 风控参数 |
| 账户回撤强制平仓 | `ACCOUNT_DRAWDOWN_FORCE_CLOSE_PERCENT` | `src/config/riskParams.ts` | 风控参数 |

## 版本历史

### v3.0 - 2025年11月15日
- **新增中长线策略**（`medium-long`）
  - 30分钟执行周期，3-10倍杠杆
  - AI主导决策，最小限制最大自由度
  - 追求中长期稳健收益（月目标25-50%）
  - 注重质量而非频率
- **新增Alpha Beta策略**（`alpha-beta`）
  - 零策略指导，AI完全自主决策
  - 强制自我复盘机制（核心特色）
  - 双重防护模式（代码自动 + AI主动）
  - 从历史中学习，持续优化
- **策略总数从9种增加到11种**
- 完善策略文档，新增两个策略的完整说明
- 更新策略切换指南和使用场景说明

### v2.4 - 2025年11月14日
- 新增激进团策略（`aggressive-team`）
- 团长+4团员专业协作决策模式，追求40-60%月回报
- **震荡识别强化**：五维30分制识别体系，避免震荡市频繁止损
- **20倍杠杆专属优化**：更严格止损（-8%）、更早止盈（15%→8%）
- **智能优先级规则**：震荡识别 > 持仓数要求，高震荡时宁可观望
- 多时间框架分层判断体系（长周期50% + 中周期30% + 短周期20%）
- 策略总数从8种增加到9种

### v2.3 - 2025年11月11日
- 新增陪审团策略（`multi-agent-consensus`）
- 法官与陪审团合议决策模式：主Agent + 三个专业Agent协作
- 双重防护机制：代码自动监控 + 法官主动决策
- 策略总数从7种增加到8种
- 完善策略切换指南和最佳实践建议

### v2.2 - 2025年11月9日
- 为所有策略参数标注配置文件位置和代码位置
- 添加配置项与代码对照表，方便快速定位配置
- 完善技术实现章节，详细说明各文件的作用
- 标注环境变量配置位置（`.env` 文件）

### v2.1 - 2025年11月8日
- 优化项目结构：将策略实现统一放置在 `src/strategies/` 目录
- 完善所有 README 文档，添加策略文件链接
- 更新策略配置指南，增加技术实现说明

### v2.0 - 2025年11月4日
- 波段策略仓位调整：12-20% → 20-35%
- 波段策略时间框架优化：15m-4h → 1m/3m/5m/15m精准捕捉
- 波段策略止损微调：-5%~-8% → -5.5%~-9%
- AI职责调整：AI只负责开仓，平仓由自动监控系统执行
- 术语优化："代码级"改为"自动监控"

### v1.0 - 2025年11月3日
- 初始版本发布

---

## 免责声明

**⚠️ 重要风险提示**

1. **投资风险**：加密货币交易具有极高风险，可能导致部分或全部本金损失。
2. **策略风险**：本文档描述的所有交易策略均为技术实现说明，不构成任何投资建议或收益承诺。
3. **测试建议**：强烈建议使用测试网（GATE_USE_TESTNET=true）进行充分测试后，再考虑是否使用真实资金。
4. **自负盈亏**：使用本系统进行交易的所有盈亏由使用者自行承担，开发者不承担任何责任。
5. **无保证声明**：本系统按"原样"提供，不提供任何明示或暗示的保证，包括但不限于适销性、特定用途适用性的保证。
6. **合规责任**：使用者需自行确保遵守所在地区的法律法规，开发者不对任何违法使用承担责任。

**请在充分理解风险并能承受可能的损失的前提下使用本系统。**

---

## 版权声明

Copyright (C) 2025 195440

本文档遵循 GNU Affero General Public License v3.0 协议。
