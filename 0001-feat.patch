From 2298fd75890ed6e7ddc48bdaef9901a3b50778d3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=E6=B4=9B=E5=9F=8E=E9=A3=8E=E8=B5=B7?= <195440@qq.com>
Date: Sun, 2 Nov 2025 20:10:35 +0800
Subject: [PATCH 1/4] =?UTF-8?q?=20feat:=20=E8=B6=85=E7=9F=AD=E7=BA=BF?=
 =?UTF-8?q?=E4=BA=A4=E6=98=93=E7=AD=96=E7=95=A5?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

 feat: 超短线交易策略
---
 README.md                           |  48 +++-
 README_EN.md                        |  19 +-
 README_JA.md                        |  19 +-
 README_ZH.md                        |  19 +-
 public/index.html                   |   1 +
 public/monitor-styles.css           |   4 +
 src/agents/tradingAgent.ts          | 336 ++++++++++++++++++++--------
 src/scheduler/tradingLoop.ts        |  48 +++-
 src/tools/trading/marketData.ts     |   5 +-
 src/tools/trading/tradeExecution.ts |  33 +++
 strategies/README.md                | 182 ---------------
 11 files changed, 405 insertions(+), 309 deletions(-)
 delete mode 100644 strategies/README.md

diff --git a/README.md b/README.md
index c30202b..d1107f3 100644
--- a/README.md
+++ b/README.md
@@ -4,7 +4,7 @@
 
 [![VoltAgent](https://img.shields.io/badge/Framework-VoltAgent-purple.svg)](https://voltagent.dev)
 [![OpenAI Compatible](https://img.shields.io/badge/AI-OpenAI_Compatible-orange.svg)](https://openrouter.ai)
-[![Gate.io](https://img.shields.io/badge/Exchange-Gate.io-00D4AA.svg)](https://www.gate.io)
+[![Gate.io](https://img.shields.io/badge/Exchange-Gate.io-00D4AA.svg)](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103)
 [![TypeScript](https://img.shields.io/badge/Language-TypeScript-3178C6.svg?logo=typescript&logoColor=white)](https://www.typescriptlang.org)
 [![Node.js](https://img.shields.io/badge/Runtime-Node.js%2020+-339933.svg?logo=node.js&logoColor=white)](https://nodejs.org)
 [![License](https://img.shields.io/badge/License-AGPL--3.0-blue.svg)](./LICENSE)
@@ -62,7 +62,7 @@ open-nof1.ai 是一个 AI 驱动的加密货币自动交易系统，将大语言
 |------|------|------|
 | 框架 | [VoltAgent](https://voltagent.dev) | AI Agent 编排与管理 |
 | AI 提供商 | OpenAI 兼容 API | 支持 OpenRouter、OpenAI、DeepSeek 等兼容供应商 |
-| 交易所 | [Gate.io](https://www.gate.io) | 加密货币交易(测试网 & 正式网) |
+| 交易所 | [Gate.io](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103) | 加密货币交易(测试网 & 正式网) |
 | 数据库 | LibSQL (SQLite) | 本地数据持久化 |
 | Web 服务器 | Hono | 高性能 HTTP 框架 |
 | 开发语言 | TypeScript | 类型安全开发 |
@@ -70,13 +70,26 @@ open-nof1.ai 是一个 AI 驱动的加密货币自动交易系统，将大语言
 
 ## 快速开始
 
-### 前置要求
+### 第一步：注册交易所账户
+
+本项目依赖 Gate.io 交易所 API。**如果您还没有账户，请先完成注册：**
+
+**推荐注册方式：**
+
+- [立即注册 Gate.io](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103)
+- 邀请码：`VVVEA10LVQ`
+
+> 通过上方邀请码注册，您可享受交易返佣优惠，同时为开源项目的持续发展提供支持。
+
+> **新手建议**：先注册并使用[测试网](https://www.gate.io/testnet)环境学习，零风险体验完整功能。
+
+### 第二步：环境准备
 
 - Node.js >= 20.19.0
 - npm 或 pnpm 包管理器
 - Git 版本控制工具
 
-### 安装
+### 第三步：安装项目
 
 ```bash
 # 克隆仓库
@@ -87,7 +100,7 @@ cd open-nof1.ai
 npm install
 ```
 
-### 配置
+### 第四步：配置
 
 在项目根目录创建 `.env` 文件:
 
@@ -127,15 +140,17 @@ ACCOUNT_DRAWDOWN_FORCE_CLOSE_PERCENT=50      # 强制平仓阈值：自动平掉
 - OpenAI: https://platform.openai.com/api-keys
 - DeepSeek: https://platform.deepseek.com/api_keys
 - Gate.io 测试网: https://www.gate.io/testnet
-- Gate.io 正式网: https://www.gate.io/myaccount/api_key_manage
+- Gate.io 正式网: https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103
 
-### 数据库初始化
+> **提示**: 通过上方邀请链接或使用邀请码 `VVVEA10LVQ` 注册 Gate.io 账户，您将获得交易佣金返还优惠。
+
+### 第五步：数据库初始化
 
 ```bash
 npm run db:init
 ```
 
-### 启动交易系统
+### 第六步：启动交易系统
 
 ```bash
 # 开发模式(热重载)
@@ -145,7 +160,7 @@ npm run dev
 npm run trading:start
 ```
 
-### 访问 Web 仪表板
+### 第七步：访问 Web 仪表板
 
 在浏览器中访问 `http://localhost:3100`
 
@@ -214,6 +229,21 @@ npm run trading:start
 
 ## 资源
 
+### 节省交易成本 & 支持项目
+
+如果您还没有 Gate.io 账户，强烈建议通过以下方式注册：
+
+**注册方式：**
+- **邀请链接**: [https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103)
+- **邀请码**: `VVVEA10LVQ`
+
+**双赢方案：**
+- **您的优势**：获得交易手续费返佣，长期使用可节省可观成本
+- **项目支持**：您的使用将帮助维护这个开源项目的持续开发
+- **无额外费用**：完全免费，不影响您的任何交易体验
+
+> **提示**：测试网和正式网可以用同一个账户，建议您先在测试网充分测试后再进行真实交易。
+
 ### 外部链接
 
 - [VoltAgent 文档](https://voltagent.dev/docs/)
diff --git a/README_EN.md b/README_EN.md
index 2862630..3ff6211 100644
--- a/README_EN.md
+++ b/README_EN.md
@@ -6,7 +6,7 @@
 
 [![VoltAgent](https://img.shields.io/badge/Framework-VoltAgent-purple.svg)](https://voltagent.dev)
 [![OpenAI Compatible](https://img.shields.io/badge/AI-OpenAI_Compatible-orange.svg)](https://openrouter.ai)
-[![Gate.io](https://img.shields.io/badge/Exchange-Gate.io-00D4AA.svg)](https://www.gate.io)
+[![Gate.io](https://img.shields.io/badge/Exchange-Gate.io-00D4AA.svg)](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103)
 [![TypeScript](https://img.shields.io/badge/Language-TypeScript-3178C6.svg?logo=typescript&logoColor=white)](https://www.typescriptlang.org)
 [![Node.js](https://img.shields.io/badge/Runtime-Node.js%2020+-339933.svg?logo=node.js&logoColor=white)](https://nodejs.org)
 [![License](https://img.shields.io/badge/License-AGPL--3.0-blue.svg)](./LICENSE)
@@ -80,7 +80,7 @@ The system follows a **minimal human intervention** design philosophy, abandonin
 |-----------|-----------|---------|
 | Framework | [VoltAgent](https://voltagent.dev) | AI Agent orchestration and management |
 | AI Provider | OpenAI Compatible API | Supports OpenRouter, OpenAI, DeepSeek and other compatible providers |
-| Exchange | [Gate.io](https://www.gate.io) | Cryptocurrency trading (testnet & mainnet) |
+| Exchange | [Gate.io](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103) | Cryptocurrency trading (testnet & mainnet) |
 | Database | LibSQL (SQLite) | Local data persistence |
 | Web Server | Hono | High-performance HTTP framework |
 | Language | TypeScript | Type-safe development |
@@ -194,7 +194,9 @@ AI_MODEL_NAME=deepseek/deepseek-v3.2-exp      # Model name
 - OpenAI: https://platform.openai.com/api-keys
 - DeepSeek: https://platform.deepseek.com/api_keys
 - Gate.io Testnet: https://www.gate.io/testnet
-- Gate.io Mainnet: https://www.gate.io/myaccount/api_key_manage
+- Gate.io Mainnet: https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103
+
+> **Tip**: Register a Gate.io account using the above referral link or invitation code `VVVEA10LVQ` to receive commission rebates on your trades.
 
 ### Database Initialization
 
@@ -723,6 +725,17 @@ npm run trading:start
 
 ## Resources
 
+### Support Continuous Project Development
+
+If you don't have a Gate.io account yet, we recommend registering through this referral:
+
+- **Referral Link**: [https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103)
+- **Invitation Code**: `VVVEA10LVQ`
+
+> By registering with the referral code, you'll receive trading commission rebates while helping maintain this open-source project's long-term operation. It benefits both you and the project, completely free with no extra costs.
+
+> **Tip**: Testnet and mainnet can use the same account. We recommend thorough testing on testnet before real trading.
+
 ### External Links
 
 - [VoltAgent Documentation](https://voltagent.dev/docs/)
diff --git a/README_JA.md b/README_JA.md
index 3d2b0ea..f146405 100644
--- a/README_JA.md
+++ b/README_JA.md
@@ -6,7 +6,7 @@
 
 [![VoltAgent](https://img.shields.io/badge/Framework-VoltAgent-purple.svg)](https://voltagent.dev)
 [![OpenAI Compatible](https://img.shields.io/badge/AI-OpenAI_Compatible-orange.svg)](https://openrouter.ai)
-[![Gate.io](https://img.shields.io/badge/Exchange-Gate.io-00D4AA.svg)](https://www.gate.io)
+[![Gate.io](https://img.shields.io/badge/Exchange-Gate.io-00D4AA.svg)](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103)
 [![TypeScript](https://img.shields.io/badge/Language-TypeScript-3178C6.svg?logo=typescript&logoColor=white)](https://www.typescriptlang.org)
 [![Node.js](https://img.shields.io/badge/Runtime-Node.js%2020+-339933.svg?logo=node.js&logoColor=white)](https://nodejs.org)
 [![License](https://img.shields.io/badge/License-AGPL--3.0-blue.svg)](./LICENSE)
@@ -80,7 +80,7 @@ open-nof1.ai は、大規模言語モデルの知能と量的取引実践を深
 |---------------|------|------|
 | フレームワーク | [VoltAgent](https://voltagent.dev) | AI Agent オーケストレーションと管理 |
 | AI プロバイダー | OpenAI 互換 API | OpenRouter、OpenAI、DeepSeek などの互換プロバイダーをサポート |
-| 取引所 | [Gate.io](https://www.gate.io) | 暗号通貨取引(テストネット & 本番ネット) |
+| 取引所 | [Gate.io](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103) | 暗号通貨取引(テストネット & 本番ネット) |
 | データベース | LibSQL (SQLite) | ローカルデータ永続化 |
 | Web サーバー | Hono | 高性能 HTTP フレームワーク |
 | 開発言語 | TypeScript | 型安全な開発 |
@@ -199,7 +199,9 @@ ACCOUNT_DRAWDOWN_FORCE_CLOSE_PERCENT=50      # 強制決済しきい値：すべ
 - OpenAI: https://platform.openai.com/api-keys
 - DeepSeek: https://platform.deepseek.com/api_keys
 - Gate.io テストネット: https://www.gate.io/testnet
-- Gate.io 本番ネット: https://www.gate.io/myaccount/api_key_manage
+- Gate.io 本番ネット: https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103
+
+> **ヒント**: 上記の招待リンクまたは招待コード `VVVEA10LVQ` を使用して Gate.io アカウントを登録すると、取引手数料のリベートを受けられます。
 
 ### データベース初期化
 
@@ -729,6 +731,17 @@ npm run trading:start
 
 ## リソース
 
+### プロジェクトの継続的発展を支援
+
+Gate.io アカウントをお持ちでない場合、以下の招待方式での登録をお勧めします：
+
+- **招待リンク**: [https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103)
+- **招待コード**: `VVVEA10LVQ`
+
+> 招待コードで登録すると、取引手数料のリベートを受けられ、同時にこのオープンソースプロジェクトの長期運営を支援できます。あなたとプロジェクトの両方にメリットがあり、完全無料で追加費用は一切ありません。
+
+> **ヒント**：テストネットと本番ネットは同じアカウントが使用可能です。実際の取引前にテストネットで十分にテストすることをお勧めします。
+
 ### 外部リンク
 
 - [VoltAgent ドキュメント](https://voltagent.dev/docs/)
diff --git a/README_ZH.md b/README_ZH.md
index 66aa8f4..31699a9 100644
--- a/README_ZH.md
+++ b/README_ZH.md
@@ -6,7 +6,7 @@
 
 [![VoltAgent](https://img.shields.io/badge/Framework-VoltAgent-purple.svg)](https://voltagent.dev)
 [![OpenAI Compatible](https://img.shields.io/badge/AI-OpenAI_Compatible-orange.svg)](https://openrouter.ai)
-[![Gate.io](https://img.shields.io/badge/Exchange-Gate.io-00D4AA.svg)](https://www.gate.io)
+[![Gate.io](https://img.shields.io/badge/Exchange-Gate.io-00D4AA.svg)](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103)
 [![TypeScript](https://img.shields.io/badge/Language-TypeScript-3178C6.svg?logo=typescript&logoColor=white)](https://www.typescriptlang.org)
 [![Node.js](https://img.shields.io/badge/Runtime-Node.js%2020+-339933.svg?logo=node.js&logoColor=white)](https://nodejs.org)
 [![License](https://img.shields.io/badge/License-AGPL--3.0-blue.svg)](./LICENSE)
@@ -80,7 +80,7 @@ open-nof1.ai 是一个 AI 驱动的加密货币自动交易系统，将大语言
 |------|------|------|
 | 框架 | [VoltAgent](https://voltagent.dev) | AI Agent 编排与管理 |
 | AI 提供商 | OpenAI 兼容 API | 支持 OpenRouter、OpenAI、DeepSeek 等兼容供应商 |
-| 交易所 | [Gate.io](https://www.gate.io) | 加密货币交易(测试网 & 正式网) |
+| 交易所 | [Gate.io](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103) | 加密货币交易(测试网 & 正式网) |
 | 数据库 | LibSQL (SQLite) | 本地数据持久化 |
 | Web 服务器 | Hono | 高性能 HTTP 框架 |
 | 开发语言 | TypeScript | 类型安全开发 |
@@ -193,7 +193,9 @@ AI_MODEL_NAME=deepseek/deepseek-v3.2-exp      # 模型名称
 - OpenAI: https://platform.openai.com/api-keys
 - DeepSeek: https://platform.deepseek.com/api_keys
 - Gate.io 测试网: https://www.gate.io/testnet
-- Gate.io 正式网: https://www.gate.io/myaccount/api_key_manage
+- Gate.io 正式网: https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103
+
+> **提示**: 通过上方邀请链接或使用邀请码 `VVVEA10LVQ` 注册 Gate.io 账户，您将获得交易佣金返还优惠。
 
 ### 数据库初始化
 
@@ -727,6 +729,17 @@ npm run trading:start
 
 ## 资源
 
+### 支持项目持续发展
+
+如果您还没有 Gate.io 账户，推荐通过以下邀请方式注册：
+
+- **邀请链接**: [https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103](https://www.gatesite.work/signup/VVVEA10LVQ?ref_type=103)
+- **邀请码**: `VVVEA10LVQ`
+
+> 使用邀请码注册，您将获得交易返佣优惠，同时帮助维护这个开源项目的长期运营。这对您和项目都有益，且完全免费无任何额外费用。
+
+> **提示**：测试网和正式网可以用同一个账户，建议您先在测试网充分测试后再进行真实交易。
+
 ### 外部链接
 
 - [VoltAgent 文档](https://voltagent.dev/docs/)
diff --git a/public/index.html b/public/index.html
index a9762f1..6d27af3 100644
--- a/public/index.html
+++ b/public/index.html
@@ -102,6 +102,7 @@
       <div class="logo">open-nof1</div>
       <nav class="nav-menu">
         <a href="#" class="nav-link active">LIVE</a>
+        <a href="https://github.com/195440/nof1.ai?tab=readme-ov-file#快速开始" class="nav-link" target="_blank" rel="noopener noreferrer">QUICK START</a>
         <a href="https://github.com/195440/open-nof1.ai" class="nav-link github-link" target="_blank" rel="noopener noreferrer">
           <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 5px;">
             <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
diff --git a/public/monitor-styles.css b/public/monitor-styles.css
index 9f1cea8..36d849d 100644
--- a/public/monitor-styles.css
+++ b/public/monitor-styles.css
@@ -1122,6 +1122,10 @@ body {
         max-width: 100vw;
         overflow: hidden;
     }
+    
+    .logo {
+        font-size: 1.2rem;
+    }
 
     .nav-bar {
         max-width: 100%;
diff --git a/src/agents/tradingAgent.ts b/src/agents/tradingAgent.ts
index aae021b..a9a28c0 100644
--- a/src/agents/tradingAgent.ts
+++ b/src/agents/tradingAgent.ts
@@ -50,7 +50,7 @@ export function getAccountRiskConfig(): AccountRiskConfig {
 /**
  * 交易策略类型
  */
-export type TradingStrategy = "conservative" | "balanced" | "aggressive";
+export type TradingStrategy = "conservative" | "balanced" | "aggressive" | "ultra-short";
 
 /**
  * 策略参数配置
@@ -129,6 +129,13 @@ export function getStrategyParams(strategy: TradingStrategy): StrategyParams {
   const aggressiveLevGood = Math.ceil((aggressiveLevMin + aggressiveLevMax) / 2);
   const aggressiveLevStrong = aggressiveLevMax;
   
+  // 超短线策略：70%-100% 的最大杠杆（高杠杆配合严格入场条件和快速止损）
+  const ultraShortLevMin = Math.max(3, Math.ceil(maxLeverage * 0.7));
+  const ultraShortLevMax = maxLeverage;
+  const ultraShortLevNormal = ultraShortLevMin;
+  const ultraShortLevGood = Math.ceil((ultraShortLevMin + ultraShortLevMax) / 2);
+  const ultraShortLevStrong = ultraShortLevMax;
+  
   const strategyConfigs: Record<TradingStrategy, StrategyParams> = {
     "conservative": {
       name: "稳健",
@@ -265,6 +272,53 @@ export function getStrategyParams(strategy: TradingStrategy): StrategyParams {
       riskTolerance: "单笔交易风险可达25-32%，追求高收益",
       tradingStyle: "积极进取，快速捕捉市场机会，追求最大化收益",
     },
+    "ultra-short": {
+      name: "超短线",
+      description: "高杠杆日内交易，3/5分钟核心共振+1分钟跟随确认，三层时间框架智能平仓，快进快出",
+      leverageMin: ultraShortLevMin,
+      leverageMax: ultraShortLevMax,
+      leverageRecommend: {
+        normal: `${ultraShortLevNormal}倍`,
+        good: `${ultraShortLevGood}倍`,
+        strong: `${ultraShortLevStrong}倍`,
+      },
+      positionSizeMin: 16,
+      positionSizeMax: 30,
+      positionSizeRecommend: {
+        normal: "16-20%",
+        good: "20-24%",
+        strong: "24-30%",
+      },
+      stopLoss: {
+        // 根据杠杆动态调整止损，目标是实际价格波动1-2%触发
+        // 计算公式：止损百分比 = 实际价格波动% × 杠杆倍数
+        // 例如：10倍杠杆，实际价格波动1.5% → 止损设为15%
+        low: Math.min(-10, -(ultraShortLevMin * 1.0)),   // 低杠杆：实际价格波动1.0%
+        mid: Math.min(-12, -(Math.ceil((ultraShortLevMin + ultraShortLevMax) / 2) * 1.2)), // 中杠杆：实际价格波动1.2%
+        high: Math.min(-15, -(ultraShortLevMax * 1.5)),  // 高杠杆：实际价格波动1.5%
+      },
+      trailingStop: {
+        // 超短线策略：调大移动止盈范围，避免过早被噪音震出
+        level1: { trigger: 4, stopAt: 2 },     // 盈利达到 +4% 时，止损线移至 +2%
+        level2: { trigger: 8, stopAt: 4 },     // 盈利达到 +8% 时，止损线移至 +4%
+        level3: { trigger: 12, stopAt: 8 },    // 盈利达到 +12% 时，止损线移至 +8%
+      },
+      partialTakeProfit: {
+        // 超短线策略：调大止盈目标，让利润充分奔跑
+        stage1: { trigger: 10, closePercent: 50 },  // +10% 平仓50%
+        stage2: { trigger: 15, closePercent: 50 },  // +15% 平仓剩余50%
+        stage3: { trigger: 20, closePercent: 100 }, // +20% 全部清仓
+      },
+      peakDrawdownProtection: 20, // 超短线策略：20%峰值回撤保护（给予更多容忍度）
+      volatilityAdjustment: {
+        highVolatility: { leverageFactor: 0.4, positionFactor: 0.5 },   // 高波动：大幅降低
+        normalVolatility: { leverageFactor: 1.0, positionFactor: 1.0 }, // 正常波动：不调整
+        lowVolatility: { leverageFactor: 1.0, positionFactor: 1.0 },    // 低波动：不调整
+      },
+      entryCondition: "3分钟与5分钟核心框架同向共振 + 1分钟跟随确认（允许提前/滞后1-2根K线），添加RSI极值过滤和资金费率检查",
+      riskTolerance: "单笔交易风险控制在16-30%之间，使用三层时间框架验证平仓",
+      tradingStyle: "日内超短线交易，使用高杠杆配合灵活入场条件（3/5分钟核心共振+1分钟跟随），平仓时三层验证（1m+3m，3m+5m，5m+15m），3分钟是关键过滤层，动态止损保护本金",
+    },
   };
 
   return strategyConfigs[strategy];
@@ -280,7 +334,7 @@ const logger = createPinoLogger({
  */
 export function getTradingStrategy(): TradingStrategy {
   const strategy = process.env.TRADING_STRATEGY || "balanced";
-  if (strategy === "conservative" || strategy === "balanced" || strategy === "aggressive") {
+  if (strategy === "conservative" || strategy === "balanced" || strategy === "aggressive" || strategy === "ultra-short") {
     return strategy;
   }
   logger.warn(`未知的交易策略: ${strategy}，使用默认策略: balanced`);
@@ -315,24 +369,24 @@ export function generateTradingPrompt(data: {
 目标月回报：${params.name === '稳健' ? '10-20%' : params.name === '平衡' ? '20-40%' : '40%+'}
 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 
-【硬性风控底线 - 系统强制执行】
+【系统硬性底线 - 必须遵守】
 ┌─────────────────────────────────────────┐
-│ 单笔亏损 ≤ -30%：强制平仓               │
-│ 持仓时间 ≥ 36小时：强制平仓             │
+│ 单笔亏损 ≤ -30%：强制平仓（防爆仓）     │
+│ 持仓时间 ≥ 36小时：强制平仓（释放资金） │
 └─────────────────────────────────────────┘
 
-【AI战术决策 - 强烈建议遵守】
+【策略建议参考 - 您可灵活调整】
 ┌─────────────────────────────────────────┐
-│ 策略止损：${params.stopLoss.low}% ~ ${params.stopLoss.high}%（根据杠杆）│
-│ 移动止盈：                               │
-│   • 盈利≥+${params.trailingStop.level1.trigger}% → 止损移至+${params.trailingStop.level1.stopAt}%  │
-│   • 盈利≥+${params.trailingStop.level2.trigger}% → 止损移至+${params.trailingStop.level2.stopAt}%  │
-│   • 盈利≥+${params.trailingStop.level3.trigger}% → 止损移至+${params.trailingStop.level3.stopAt}% │
-│ 分批止盈：                               │
-│   • 盈利≥+${params.partialTakeProfit.stage1.trigger}% → 平仓${params.partialTakeProfit.stage1.closePercent}%  │
-│   • 盈利≥+${params.partialTakeProfit.stage2.trigger}% → 平仓${params.partialTakeProfit.stage2.closePercent}%  │
-│   • 盈利≥+${params.partialTakeProfit.stage3.trigger}% → 平仓${params.partialTakeProfit.stage3.closePercent}% │
-│ 峰值回撤：≥${params.peakDrawdownProtection}% → 危险信号，立即平仓 │
+│ 参考止损：${params.stopLoss.low}% ~ ${params.stopLoss.high}%（您可根据实际情况调整）│
+│ 参考移动止盈：                           │
+│   • 盈利≥+${params.trailingStop.level1.trigger}% → 建议止损+${params.trailingStop.level1.stopAt}%（您可调整） │
+│   • 盈利≥+${params.trailingStop.level2.trigger}% → 建议止损+${params.trailingStop.level2.stopAt}%（您可调整） │
+│   • 盈利≥+${params.trailingStop.level3.trigger}% → 建议止损+${params.trailingStop.level3.stopAt}%（您可调整）│
+│ 参考分批止盈：                           │
+│   • 盈利≥+${params.partialTakeProfit.stage1.trigger}% → 参考平仓${params.partialTakeProfit.stage1.closePercent}%（您决定） │
+│   • 盈利≥+${params.partialTakeProfit.stage2.trigger}% → 参考平仓${params.partialTakeProfit.stage2.closePercent}%（您决定） │
+│   • 盈利≥+${params.partialTakeProfit.stage3.trigger}% → 参考平仓${params.partialTakeProfit.stage3.closePercent}%（您决定）│
+│ 峰值回撤：≥${params.peakDrawdownProtection}% → 警示信号（您自主判断）│
 └─────────────────────────────────────────┘
 
 【决策流程 - 按优先级执行】
@@ -608,25 +662,26 @@ export function generateTradingPrompt(data: {
 function generateInstructions(strategy: TradingStrategy, intervalMinutes: number): string {
   const params = getStrategyParams(strategy);
   
-  return `您是一位经验丰富的加密货币期货量化交易员，当前采用【${params.name}】策略。您的目标是${params.tradingStyle}。
-
-您的身份：
-- 15年量化交易经验，${params.description}
-- 您深知加密货币市场的高波动性，${params.tradingStyle}
-- 您的优势：严格的纪律、系统化决策、情绪中立和对风险收益的深刻理解
-- 您像系统工程师一样交易：精确、基于数据、且始终遵守规则
-
-您的交易目标：
-- **最大化风险调整后收益**（夏普比率）
-- **目标月回报**：${params.name === '稳健' ? '10-20%' : params.name === '平衡' ? '20-40%' : '40%+'}
-- **胜率目标**：≥55%（通过严格的入场条件和及时止损实现）
-- **盈亏比目标**：≥2:1（平均盈利应该≥2倍平均亏损）
-- **风险控制理念**：${params.riskTolerance}
-
-您的交易理念（${params.name}策略）：
-1. **风险控制优先**：${params.riskTolerance}
-2. **入场条件**：${params.entryCondition}
-3. **仓位管理规则（核心）**：
+  return `您是全球顶级的加密货币交易冠军，拥有30年实战交易经验。当前参考【${params.name}】策略框架，但您有完全的自主权根据市场实际情况灵活调整。
+
+您的身份定位：
+- 全球虚拟货币交易冠军，30年实战经验，见证并驾驭过无数次牛熊转换
+- 您的交易直觉和经验判断胜过任何固定规则，能敏锐捕捉市场微妙变化
+- 您的目标：创造盈利新纪录，用实力证明顶级交易者的价值
+- 您深知：市场瞬息万变，固定规则会错失良机，灵活应变才是王道
+- 您的优势：30年经验沉淀的市场嗅觉、冷静果断的决策力、精准的风险把控能力
+
+您的终极目标：
+- **创造盈利新纪录**：用您30年的交易智慧，实现超越策略建议的卓越回报
+- **月回报目标**：${params.name === '稳健' ? '10-20%起步' : params.name === '平衡' ? '20-40%起步' : '40%+起步'}，但您有能力做得更好
+- **胜率追求**：凭借您的经验，争取≥60-70%的胜率（远超常规策略）
+- **盈亏比追求**：≥3:1或更高（让盈利充分奔跑，快速止损）
+- **风险哲学**：${params.riskTolerance}，但您会根据实际情况灵活调整
+
+您的交易哲学（参考${params.name}策略，但您有完全自主权）：
+1. **风险与机会的平衡**：${params.riskTolerance}（建议值，您可根据市场情况灵活调整）
+2. **入场时机判断**：${params.entryCondition}（这是参考建议，您的30年经验更重要）
+3. **仓位管理智慧（核心原则）**：
    - **同一币种只能持有一个方向的仓位**：不允许同时持有 BTC 多单和 BTC 空单
    - **趋势反转必须先平仓**：如果当前持有 BTC 多单，想开 BTC 空单时，必须先平掉多单
    - **防止对冲风险**：双向持仓会导致资金锁定、双倍手续费和额外风险
@@ -657,21 +712,21 @@ function generateInstructions(strategy: TradingStrategy, intervalMinutes: number
    - 强信号：${params.leverageRecommend.strong}
 9. **成本意识交易**：每笔往返交易成本约0.1%（开仓0.05% + 平仓0.05%）。潜在利润≥2-3%时即可考虑交易。
 
-当前交易规则（${params.name}策略）：
-- 您交易加密货币的永续期货合约（${RISK_PARAMS.TRADING_SYMBOLS.join('、')}）
-- 仅限市价单 - 以当前价格即时执行
-- **杠杆控制（严格限制）**：必须使用${params.leverageMin}-${params.leverageMax}倍杠杆。
-  * ${params.leverageRecommend.normal}：用于普通信号
-  * ${params.leverageRecommend.good}：用于良好信号
-  * ${params.leverageRecommend.strong}：仅用于强信号
-  * **禁止**使用低于${params.leverageMin}倍或超过${params.leverageMax}倍杠杆
-- **仓位大小（${params.name}策略）**：
-  * ${params.riskTolerance}
-  * 普通信号：使用${params.positionSizeRecommend.normal}仓位
-  * 良好信号：使用${params.positionSizeRecommend.good}仓位
-  * 强信号：使用${params.positionSizeRecommend.strong}仓位
-  * 最多同时持有${RISK_PARAMS.MAX_POSITIONS}个持仓
-  * 总名义敞口不超过账户净值的${params.leverageMax}倍
+交易环境与参考框架（${params.name}策略）：
+- 交易标的：加密货币永续期货合约（${RISK_PARAMS.TRADING_SYMBOLS.join('、')}）
+- 执行方式：市价单 - 以当前市场价格即时执行
+- **杠杆参考范围**：建议${params.leverageMin}-${params.leverageMax}倍，但您可根据信号强度和市场情况灵活调整
+  * ${params.leverageRecommend.normal}：参考用于普通信号（您可以调整）
+  * ${params.leverageRecommend.good}：参考用于良好信号（您可以调整）
+  * ${params.leverageRecommend.strong}：参考用于强信号（您可以调整）
+  * 作为冠军交易者，您有权根据实际情况使用最合适的杠杆
+- **仓位参考建议（${params.name}策略）**：
+  * 风险偏好：${params.riskTolerance}（您可灵活调整）
+  * 普通信号参考：${params.positionSizeRecommend.normal}仓位
+  * 良好信号参考：${params.positionSizeRecommend.good}仓位
+  * 强信号参考：${params.positionSizeRecommend.strong}仓位
+  * 最多同时持有${RISK_PARAMS.MAX_POSITIONS}个持仓（硬性限制）
+  * 总名义敞口建议不超过账户净值的${params.leverageMax}倍（您可适当调整）
 - 交易费用：每笔交易约0.05%（往返总计0.1%）。每笔交易应有至少2-3%的盈利潜力。
 - **执行周期**：系统每${intervalMinutes}分钟执行一次，这意味着：
   * 36小时 = ${Math.floor(36 * 60 / intervalMinutes)}个执行周期
@@ -690,52 +745,54 @@ function generateInstructions(strategy: TradingStrategy, intervalMinutes: number
   * 加仓频次：单个币种最多加仓2次（总共3个批次）
   * 杠杆要求：加仓时使用与原持仓相同或更低的杠杆
   * 风控检查：加仓后该币种总敞口不超过账户净值的${params.leverageMax}倍
-- **风控策略（系统硬性底线 + AI战术灵活性）**：
+- **风控策略（系统底线 + 冠军交易者自主权）**：
   
-  【系统硬性底线 - 强制执行，不可违反】：
+  【系统硬性底线 - 必须遵守】：
   * 单笔亏损 ≤ -30%：系统强制平仓（防止爆仓）
   * 持仓时间 ≥ 36小时：系统强制平仓（释放资金）
   
-  【AI战术决策 - 专业建议，灵活执行】：
+  【策略建议参考 - 您有完全自主权】：
   
-  (1) 止损策略（专业风控建议）：
-     * 策略止损线（基于统计优化，强烈建议遵守）：
-       - ${params.leverageMin}-${Math.floor((params.leverageMin + params.leverageMax) / 2)}倍杠杆：建议止损 ${params.stopLoss.low}%
-       - ${Math.floor((params.leverageMin + params.leverageMax) / 2)}-${Math.ceil((params.leverageMin + params.leverageMax) * 0.75)}倍杠杆：建议止损 ${params.stopLoss.mid}%
-       - ${Math.ceil((params.leverageMin + params.leverageMax) * 0.75)}-${params.leverageMax}倍杠杆：建议止损 ${params.stopLoss.high}%
-     * 灵活调整：可根据关键支撑位、趋势强度微调±1-2%
-     * 重要警告：突破止损线后继续持有，需有充分理由（如测试关键支撑、假突破）
+  (1) 止损参考建议（您可根据实际情况灵活调整）：
+     * 参考止损线（基于统计，但您的30年经验更重要）：
+       - ${params.leverageMin}-${Math.floor((params.leverageMin + params.leverageMax) / 2)}倍杠杆：参考止损 ${params.stopLoss.low}%
+       - ${Math.floor((params.leverageMin + params.leverageMax) / 2)}-${Math.ceil((params.leverageMin + params.leverageMax) * 0.75)}倍杠杆：参考止损 ${params.stopLoss.mid}%
+       - ${Math.ceil((params.leverageMin + params.leverageMax) * 0.75)}-${params.leverageMax}倍杠杆：参考止损 ${params.stopLoss.high}%
+     * 作为30年经验的交易冠军，您可以根据关键支撑位、趋势强度、市场情绪灵活调整
+     * 您的经验判断优先于固定规则，相信您的直觉
      * 说明：pnl_percent已包含杠杆效应，直接比较即可
   
-  (2) 移动止盈策略（保护利润的核心机制，强烈建议执行）：
-     * ${params.name}策略的移动止盈建议（已根据${params.leverageMax}倍最大杠杆优化）：
-       - 盈利 ≥ +${params.trailingStop.level1.trigger}% → 建议将止损移至+${params.trailingStop.level1.stopAt}%（保护至少${params.trailingStop.level1.stopAt}%利润）
-       - 盈利 ≥ +${params.trailingStop.level2.trigger}% → 建议将止损移至+${params.trailingStop.level2.stopAt}%（保护至少${params.trailingStop.level2.stopAt}%利润）
-       - 盈利 ≥ +${params.trailingStop.level3.trigger}% → 建议将止损移至+${params.trailingStop.level3.stopAt}%（保护至少${params.trailingStop.level3.stopAt}%利润）
-     * 灵活调整：
-       - 强趋势行情：可适当放宽止损线，给利润更多空间
-       - 震荡行情：应严格执行，避免利润回吐
-     * 说明：这些阈值已针对您的杠杆范围（${params.leverageMin}-${params.leverageMax}倍）优化
+  (2) 移动止盈参考建议（您可根据实际趋势灵活调整）：
+     * ${params.name}策略的参考建议（您可以做得更好）：
+       - 盈利 ≥ +${params.trailingStop.level1.trigger}% → 参考移至+${params.trailingStop.level1.stopAt}%（您可根据趋势调整）
+       - 盈利 ≥ +${params.trailingStop.level2.trigger}% → 参考移至+${params.trailingStop.level2.stopAt}%（您可根据趋势调整）
+       - 盈利 ≥ +${params.trailingStop.level3.trigger}% → 参考移至+${params.trailingStop.level3.stopAt}%（您可根据趋势调整）
+     * 作为冠军交易者：
+       - 强趋势行情：您可以放宽止损，让利润充分奔跑
+       - 震荡行情：您可以收紧止损，快速锁定利润
+       - 相信您的盘感和30年经验
+     * 说明：这些只是参考值，您的判断更重要
   
-  (3) 分批止盈策略（专业获利技巧）：
-     * ${params.name}策略的分批止盈建议（已根据${params.leverageMax}倍最大杠杆优化）：
-       - 盈利 ≥ +${params.partialTakeProfit.stage1.trigger}% → 建议平仓${params.partialTakeProfit.stage1.closePercent}%（锁定一半利润，让剩余持仓追求更高收益）
-       - 盈利 ≥ +${params.partialTakeProfit.stage2.trigger}% → 建议平仓剩余${params.partialTakeProfit.stage2.closePercent}%（累计平仓100%）
-       - 盈利 ≥ +${params.partialTakeProfit.stage3.trigger}% → 建议全部清仓（避免贪婪导致利润回吐）
+  (3) 分批止盈参考建议（您可自主决策）：
+     * ${params.name}策略的参考建议（您可以做得更好）：
+       - 盈利 ≥ +${params.partialTakeProfit.stage1.trigger}% → 参考平仓${params.partialTakeProfit.stage1.closePercent}%（您可自主决定比例和时机）
+       - 盈利 ≥ +${params.partialTakeProfit.stage2.trigger}% → 参考平仓${params.partialTakeProfit.stage2.closePercent}%（您可自主决定比例和时机）
+       - 盈利 ≥ +${params.partialTakeProfit.stage3.trigger}% → 参考全部清仓（您可自主决定是否继续持有）
      * 执行方式：使用 closePosition 的 percentage 参数
        - 示例：closePosition(symbol: 'BTC', percentage: 50) 可平掉50%仓位
-     * 灵活调整：
-       - 强趋势：可推迟触发（等待更高利润）
-       - 震荡行情：可提前触发（尽早锁定利润）
-     * 说明：这些阈值已针对您的杠杆范围（${params.leverageMin}-${params.leverageMax}倍）优化
+     * 作为冠军交易者：
+       - 强趋势：您可以推迟或跳过分批，让利润充分奔跑
+       - 震荡行情：您可以提前分批，快速落袋为安
+       - 您的盘感比固定规则更可靠
+     * 说明：这些只是参考，您的判断更重要
   
-  (4) 峰值回撤保护（危险信号）：
-     * ${params.name}策略的峰值回撤阈值：${params.peakDrawdownProtection}%（已根据风险偏好优化）
+  (4) 峰值回撤参考（供您参考的警示信号）：
+     * ${params.name}策略的参考阈值：${params.peakDrawdownProtection}%（您可以根据实际情况调整）
      * 如果持仓曾达到峰值盈利，当前盈利从峰值回撤 ≥ ${params.peakDrawdownProtection}%
      * 计算方式：回撤% = (峰值盈利 - 当前盈利) / 峰值盈利 × 100%
-     * 示例：峰值+${Math.round(params.peakDrawdownProtection * 1.2)}% → 当前+${Math.round(params.peakDrawdownProtection * 1.2 * (1 - params.peakDrawdownProtection / 100))}%，回撤${params.peakDrawdownProtection}%（危险！）
-     * 强烈建议：立即平仓或至少减仓50%
-     * 例外情况：有明确证据表明只是正常回调（如测试均线支撑）
+     * 示例：峰值+${Math.round(params.peakDrawdownProtection * 1.2)}% → 当前+${Math.round(params.peakDrawdownProtection * 1.2 * (1 - params.peakDrawdownProtection / 100))}%，回撤${params.peakDrawdownProtection}%（警示信号）
+     * 参考建议：考虑平仓或减仓
+     * 但作为冠军交易者，您可以根据趋势强度、关键支撑位等因素灵活判断
   
   (5) 时间止盈建议：
      * 盈利 > 25% 且持仓 ≥ 4小时 → 可考虑主动获利了结
@@ -755,6 +812,9 @@ function generateInstructions(strategy: TradingStrategy, intervalMinutes: number
 
 2. 现有持仓管理（优先于开新仓，必须实际执行工具）：
    - 立即调用 getPositions 获取所有持仓信息
+   - 重要保护机制：系统会自动拒绝平掉持仓时间少于 ${intervalMinutes} 分钟的仓位
+   - 这是为了防止在同一周期内刚开仓就立即平仓，造成不必要的手续费损失
+   - 如果尝试平仓被拒绝，请理解这是风控保护，等待下一个周期再评估
    - 对每个持仓进行专业分析和决策（每个决策都要实际执行工具）：
    
    a) 止损决策：
@@ -792,7 +852,75 @@ function generateInstructions(strategy: TradingStrategy, intervalMinutes: number
       - 强烈建议立即调用 closePosition 平仓
       - 记住：趋势是你的朋友，反转是你的敌人
       - 反转后想开反向仓位，必须先平掉原持仓（禁止对冲）
-
+   ${strategy === 'ultra-short' ? `
+   f) 超短线策略专属：三层时间框架智能平仓决策（含趋势反转延迟确认机制）
+      【核心原则】利用3分钟作为关键过滤层，避免被1分钟噪音震出，同时不错过真正的趋势反转
+      【反转延迟确认】趋势反转信号需要两个周期确认，防止假反转导致过早平仓
+      
+      【平仓决策流程】（按顺序执行，三层过滤，层层把关）：
+      
+      步骤1：快速检查层（1m + 3m 双重验证）
+      - 调用 getTechnicalIndicators(symbol, "1m") 获取1分钟数据
+      - 调用 getTechnicalIndicators(symbol, "3m") 获取3分钟数据
+      - 判断标准：
+        * 做多持仓：
+          - 如果 1m 转弱（价格<EMA20 或 MACD<0 或 RSI7<45）
+          - 但 3m 仍强势（价格>EMA20 且 MACD>0 且 RSI7>50）→ 继续持有（可能只是1分钟噪音）
+          - 如果 1m 和 3m 都转弱 → 进入步骤2
+        * 做空持仓：
+          - 如果 1m 转强（价格>EMA20 或 MACD>0 或 RSI7>55）
+          - 但 3m 仍弱势（价格<EMA20 且 MACD<0 且 RSI7<50）→ 继续持有（可能只是1分钟噪音）
+          - 如果 1m 和 3m 都转强 → 进入步骤2
+      
+      步骤2：中期确认层（3m + 5m 交叉验证）
+      - 调用 getTechnicalIndicators(symbol, "5m") 获取5分钟数据
+      - 重新分析 3m 和 5m 的方向一致性
+      - 判断标准：
+        * 做多持仓：
+          - 如果 3m 转弱但 5m 仍强势（价格>EMA20 且 MACD>0 且 RSI7>50）→ 继续持有（给第二次机会）
+          - 如果 3m 和 5m 都转弱 → 进入步骤3
+        * 做空持仓：
+          - 如果 3m 转强但 5m 仍弱势（价格<EMA20 且 MACD<0 且 RSI7<50）→ 继续持有（给第二次机会）
+          - 如果 3m 和 5m 都转强 → 进入步骤3
+      
+      步骤3：最终决策层（5m + 15m 趋势确认 + 延迟确认机制）
+      - 调用 getTechnicalIndicators(symbol, "15m") 获取15分钟数据
+      - 分析 15m 的趋势方向（最后的保护）
+      
+      【重要】趋势反转延迟确认机制：
+      - 如果本周期首次检测到趋势反转迹象 → 不要立即平仓！
+      - 在您的分析中记录"疑似反转警告"，说明："{symbol} 检测到趋势反转信号（15m转弱/转强），延迟确认，下周期再次检查"
+      - 等待下一个交易周期，再次检查是否仍然反转
+      - 如果连续两个周期都显示反转 → 才调用 closePosition 平仓（确认真实反转）
+      - 如果下周期反转信号消失 → 继续持有原仓位（避免被假信号震出）
+      
+      判断标准（需要连续两周期确认）：
+        * 做多持仓：
+          - 第一次检测：15m 转弱（价格<EMA20 或 MACD<0 或 RSI7<50）→ 记录警告，继续持有
+          - 第二次检测（下周期）：如果 15m 仍然转弱 → 调用 closePosition 平仓（确认趋势反转）
+          - 第二次检测（下周期）：如果 15m 恢复强势 → 取消警告，继续持有
+        * 做空持仓：
+          - 第一次检测：15m 转强（价格>EMA20 或 MACD>0 或 RSI7>50）→ 记录警告，继续持有
+          - 第二次检测（下周期）：如果 15m 仍然转强 → 调用 closePosition 平仓（确认趋势反转）
+          - 第二次检测（下周期）：如果 15m 恢复弱势 → 取消警告，继续持有
+      
+      盈利优化策略：
+      - 盈利≥5% 且短周期(1/3m)反转 → 考虑部分平仓50%，锁定部分利润
+      - 盈利≥10% → 即使趋势未反转，也考虑部分平仓50%，保护利润
+      
+      特殊情况处理（无需延迟确认，立即平仓）：
+      - 亏损达到动态止损线（低杠杆-10%/中杠杆-12%/高杠杆-15%，对应实际价格波动1-1.5%） → 立即止损
+      - 峰值回撤≥20% → 立即平仓保护利润
+      - 止损/止盈触发 → 直接平仓
+      - 这些情况无需等待延迟确认，立即执行平仓保护资金
+      
+      【核心思想】：
+      (1) 1分钟看信号，3分钟过滤噪音（关键！）
+      (2) 5分钟确认方向，15分钟把控趋势
+      (3) 趋势反转需要两周期确认，防止假反转
+      (4) 宁可晚一点平仓，也不要被假信号震出好趋势
+      (5) 止损和回撤保护立即执行，不延迟
+` : ''}
 3. 分析市场数据（必须实际调用工具）：
    - 调用 getTechnicalIndicators 获取技术指标数据
    - 分析多个时间框架（15分钟、30分钟、1小时、4小时）
@@ -804,7 +932,7 @@ function generateInstructions(strategy: TradingStrategy, intervalMinutes: number
    a) 加仓评估（对已有盈利持仓）：
       - 该币种已有持仓且方向正确
       - 持仓当前盈利（pnl_percent > 5%，必须有足够利润缓冲）
-      - 趋势继续强化：至少3个时间框架共振，技术指标增强
+      - 趋势继续强化：${strategy === 'ultra-short' ? '必须验证3分钟与5分钟核心框架共振（调用 getTechnicalIndicators 分别获取3m/5m数据），1分钟跟随确认，技术指标增强' : '至少3个时间框架共振，技术指标增强'}
       - 可用余额充足，加仓金额≤原仓位的50%
       - 该币种加仓次数 < 2次
       - 加仓后总敞口不超过账户净值的${params.leverageMax}倍
@@ -813,8 +941,8 @@ function generateInstructions(strategy: TradingStrategy, intervalMinutes: number
    
    b) 新开仓评估（新币种）：
       - 现有持仓数 < ${RISK_PARAMS.MAX_POSITIONS}
-      - ${params.entryCondition}
-      - 潜在利润≥2-3%（扣除0.1%费用后仍有净收益）
+      - ${params.entryCondition}${strategy === 'ultra-short' ? '\n      - 超短线策略核心开仓条件（放宽共振条件，提高成功率）：\n        步骤1：调用 getTechnicalIndicators(symbol, "3m") 获取3分钟数据（核心框架）\n        步骤2：调用 getTechnicalIndicators(symbol, "5m") 获取5分钟数据（核心框架）\n        步骤3：调用 getTechnicalIndicators(symbol, "1m") 获取1分钟数据（跟随确认）\n        步骤4：调用 getFundingRate(symbol) 获取资金费率（避免拥挤踩踏）\n        \n        【核心条件：3m与5m必须同向共振】：\n        做多方向（3m和5m都必须满足）：\n          - 3分钟：价格 > EMA20、MACD > 0、RSI7 > 50（核心过滤层）\n          - 5分钟：价格 > EMA20、MACD > 0、RSI7 > 50（趋势确认）\n          - 成交量：当前成交量 > 平均成交量 × 1.3（确认资金介入）\n        \n        做空方向（3m和5m都必须满足）：\n          - 3分钟：价格 < EMA20、MACD < 0、RSI7 < 50（核心过滤层）\n          - 5分钟：价格 < EMA20、MACD < 0、RSI7 < 50（趋势确认）\n          - 成交量：当前成交量 > 平均成交量 × 1.3（确认资金介入）\n        \n        【1m跟随确认（可以提前/滞后1-2根K线）】：\n        做多方向：\n          - 1分钟趋势方向向上（价格在EMA20上方 或 MACD方向向上）\n          - 或RSI7已经>45且有上升趋势\n          - 允许1m暂时弱于3m/5m（给予1-2根K线的容忍度）\n        \n        做空方向：\n          - 1分钟趋势方向向下（价格在EMA20下方 或 MACD方向向下）\n          - 或RSI7已经<55且有下降趋势\n          - 允许1m暂时强于3m/5m（给予1-2根K线的容忍度）\n        \n        【RSI极值过滤（强化信号质量）】：\n        做多方向：\n          - 建议RSI7 < 35时入场（超卖反弹机会）\n          - 或RSI7在35-55之间且处于上升阶段\n        \n        做空方向：\n          - 建议RSI7 > 65时入场（超买回落机会）\n          - 或RSI7在45-65之间且处于下降阶段\n        \n        【资金费率过滤（避免踩踏风险）】：\n        做多方向：\n          - 排除资金费率 > 0.05% 的信号（多头过度拥挤）\n          - 资金费率在-0.05%到0.05%之间为最佳\n        \n        做空方向：\n          - 排除资金费率 < -0.05% 的信号（空头过度拥挤）\n          - 资金费率在-0.05%到0.05%之间为最佳\n        \n        注意：核心原则是3m与5m必须同向共振（这是趋势确认），1m跟随即可（允许提前或滞后），RSI和资金费率用于过滤极端情况。' : ''}
+      - 潜在利润≥${strategy === 'ultra-short' ? '1.5-2%（快进快出，小利积累）' : '2-3%（扣除0.1%费用后仍有净收益）'}
       - 做多和做空机会的识别：
         * 做多信号：价格突破EMA20/50上方，MACD转正，RSI7 > 50且上升，多个时间框架共振向上
         * 做空信号：价格跌破EMA20/50下方，MACD转负，RSI7 < 50且下降，多个时间框架共振向下
@@ -837,17 +965,26 @@ function generateInstructions(strategy: TradingStrategy, intervalMinutes: number
 - 账户信息：getAccountBalance、getPositions、getOpenOrders
 - 风险分析：calculateRisk、checkOrderStatus
 
-关键提醒（${params.name}策略）：
+顶级交易者行动准则：
 
-最重要：您必须实际执行工具，不要只停留在分析！
+作为全球交易冠军，您必须果断行动，不能只停留在分析！
 - 不要只说"我会平仓"、"应该开仓"、"建议止损"
-- 立即调用 closePosition、openPosition 等工具
-- 每个决策都要转化为实际的工具调用
+- 立即调用 closePosition、openPosition 等工具执行
+- 每个决策都要转化为实际的工具调用，用行动创造盈利
+- 相信您的30年经验和判断，策略只是参考，市场实际情况更重要
+
+同周期保护机制（重要风控规则）：
+- 系统会自动拒绝平掉持仓时间少于 ${intervalMinutes} 分钟的仓位
+- 这是为了防止在同一周期内刚开仓就立即平仓
+- 如果您尝试平仓被拒绝，说明该仓位太新，请等待下一个周期再评估
+- 此规则无法绕过，是硬性风控保护
 
-交易目标：
-- 最大化风险调整后收益（夏普比率≥1.5）
-- 目标月回报：${params.name === '稳健' ? '10-20%' : params.name === '平衡' ? '20-40%' : '40%+'}
-- 胜率目标：≥55%，盈亏比目标：≥2:1
+终极目标（创造盈利新纪录）：
+- 用您的30年经验，创造超越策略建议的卓越回报
+- 月回报：${params.name === '稳健' ? '10-20%起步' : params.name === '平衡' ? '20-40%起步' : params.name === '激进' ? '40%+起步' : '20-30%起步'}，但您有能力突破上限
+- 胜率追求：凭借经验争取≥60-70%（您的判断力是最大优势）
+- 盈亏比：≥3:1或更高（让盈利奔跑，快速止损劣势交易）
+- 夏普比率：≥2.0（用稳定性证明您的实力）
 
 风控层级：
 - 系统硬性底线（强制执行）：
@@ -878,10 +1015,11 @@ function generateInstructions(strategy: TradingStrategy, intervalMinutes: number
 3. 分析市场寻找机会 → 立即调用 getTechnicalIndicators
 4. 评估并执行新开仓 → 立即调用 openPosition
 
-专业交易原则：
-- 趋势是你的朋友，反转是你的敌人（3个时间框架反转=强烈警告）
-- 保护利润比追求利润更重要（移动止盈是核心）
-- 亏损要快速止损，盈利要让它奔跑（但要保护）
+冠军交易者的智慧：
+- 趋势是朋友，但您有能力捕捉反转机会（30年经验是最大资本）
+- 让盈利充分奔跑，快速止损劣势交易（盈亏比≥3:1）
+- 策略只是参考框架，市场实际情况和您的直觉更重要
+- 相信自己的判断，用实力创造盈利新纪录
 - pnl_percent已包含杠杆效应，直接比较即可
 
 市场数据按时间顺序排列（最旧 → 最新），跨多个时间框架。使用此数据识别多时间框架趋势和关键水平。`;
diff --git a/src/scheduler/tradingLoop.ts b/src/scheduler/tradingLoop.ts
index e8bd1c1..0e97fb3 100644
--- a/src/scheduler/tradingLoop.ts
+++ b/src/scheduler/tradingLoop.ts
@@ -22,7 +22,7 @@
 import cron from "node-cron";
 import { createPinoLogger } from "@voltagent/logger";
 import { createClient } from "@libsql/client";
-import { createTradingAgent, generateTradingPrompt, getAccountRiskConfig } from "../agents/tradingAgent";
+import { createTradingAgent, generateTradingPrompt, getAccountRiskConfig, getTradingStrategy, getStrategyParams } from "../agents/tradingAgent";
 import { createGateClient } from "../services/gateClient";
 import { getChinaTimeISO } from "../utils/timeUtils";
 import { RISK_PARAMS } from "../config/riskParams";
@@ -108,13 +108,13 @@ async function collectMarketData() {
         }
       }
       
-      // 获取所有时间框架的K线数据
-      const candles1m = await gateClient.getFuturesCandles(contract, "1m", 60);
-      const candles3m = await gateClient.getFuturesCandles(contract, "3m", 60);
-      const candles5m = await gateClient.getFuturesCandles(contract, "5m", 100);
-      const candles15m = await gateClient.getFuturesCandles(contract, "15m", 96);
-      const candles30m = await gateClient.getFuturesCandles(contract, "30m", 90);
-      const candles1h = await gateClient.getFuturesCandles(contract, "1h", 120);
+      // 获取所有时间框架的K线数据（优化后的配置，确保技术指标准确性）
+      const candles1m = await gateClient.getFuturesCandles(contract, "1m", 150);   // 2.5小时，EMA50有充足验证数据
+      const candles3m = await gateClient.getFuturesCandles(contract, "3m", 120);   // 6小时，覆盖半个交易日
+      const candles5m = await gateClient.getFuturesCandles(contract, "5m", 100);   // 8.3小时，日内趋势分析
+      const candles15m = await gateClient.getFuturesCandles(contract, "15m", 96);  // 24小时，完整一天
+      const candles30m = await gateClient.getFuturesCandles(contract, "30m", 120); // 2.5天，中期趋势
+      const candles1h = await gateClient.getFuturesCandles(contract, "1h", 168);   // 7天完整一周，周级别分析
       
       // 计算每个时间框架的指标
       const indicators1m = calculateIndicators(candles1m);
@@ -1238,7 +1238,37 @@ async function executeTradingDecision() {
         logger.error(`${closeReason}`);
       }
       
-      // c) 其他风控检查已移除，交由AI全权决策
+      // c) 超短线策略专属风控规则
+      const strategy = getTradingStrategy();
+      if (strategy === 'ultra-short' && !shouldClose) {
+        const holdingMinutes = holdingHours * 60;
+        
+        // 计算手续费成本（开仓 + 平仓，总共约 0.1%）
+        // 考虑杠杆后，需要的盈利百分比 = 0.1% * 杠杆
+        const feeThreshold = 0.1 * leverage;
+        
+        // 移动止盈的第一档触发阈值
+        const params = getStrategyParams(strategy);
+        const trailingStopTrigger = params.trailingStop.level1.trigger; // 4%
+        
+        // 规则1：每周期2%锁利规则（优先级最高）
+        // 每个交易周期内，如果盈利 >2% 但未触发移动止盈（<4%），立即平仓锁定利润
+        if (pnlPercent > 2 && pnlPercent < trailingStopTrigger) {
+          shouldClose = true;
+          closeReason = `超短线策略周期锁利规则：盈利${pnlPercent.toFixed(2)}% >2%，未达到移动止盈触发线${trailingStopTrigger}%，立即平仓锁定利润`;
+          logger.info(`【超短线周期锁利】${symbol} ${closeReason}`);
+        }
+        
+        // 规则2：30分钟盈利平仓规则（保底规则）
+        // 如果持仓超过30分钟，处于盈利状态，但没有触发移动止盈，且覆盖了交易费，进行平仓
+        if (!shouldClose && holdingMinutes >= 30 && pnlPercent > feeThreshold && pnlPercent < trailingStopTrigger) {
+          shouldClose = true;
+          closeReason = `超短线策略30分钟盈利平仓规则：持仓${holdingMinutes.toFixed(1)}分钟，盈利${pnlPercent.toFixed(2)}%（已覆盖手续费${feeThreshold.toFixed(2)}%），但未达到移动止盈触发线${trailingStopTrigger}%，执行保守平仓`;
+          logger.info(`【超短线30分钟规则】${symbol} ${closeReason}`);
+        }
+      }
+      
+      // d) 其他风控检查已移除，交由AI全权决策
       // AI负责：止损、移动止盈、分批止盈、时间止盈、峰值回撤等策略性决策
       // 系统只保留底线安全保护（极端止损、36小时强制平仓、账户回撤保护）
       
diff --git a/src/tools/trading/marketData.ts b/src/tools/trading/marketData.ts
index 730da88..3101133 100644
--- a/src/tools/trading/marketData.ts
+++ b/src/tools/trading/marketData.ts
@@ -213,6 +213,9 @@ function calculateIndicators(candles: any[]) {
     avgVolume: ensureFinite(volumes.length > 0 ? volumes.reduce((a, b) => a + b, 0) / volumes.length : 0),
     atr3: ensureFinite(calculateATR(candles, 3)),
     atr14: ensureFinite(calculateATR(candles, 14)),
+    volumeRatio: ensureFinite(volumes.length > 0 && (volumes.reduce((a, b) => a + b, 0) / volumes.length) > 0 
+      ? (volumes.at(-1) || 0) / (volumes.reduce((a, b) => a + b, 0) / volumes.length) 
+      : 1),
   };
 }
 
@@ -253,7 +256,7 @@ export const getTechnicalIndicatorsTool = createTool({
   description: "获取指定币种的技术指标（EMA、MACD、RSI等）",
   parameters: z.object({
     symbol: z.enum(RISK_PARAMS.TRADING_SYMBOLS).describe("币种代码"),
-    interval: z.enum(["1m", "5m", "15m", "1h", "4h"]).default("5m").describe("K线周期"),
+    interval: z.enum(["1m", "3m", "5m", "15m", "30m", "1h", "4h"]).default("5m").describe("K线周期"),
     limit: z.number().default(100).describe("K线数量"),
   }),
   execute: async ({ symbol, interval, limit }) => {
diff --git a/src/tools/trading/tradeExecution.ts b/src/tools/trading/tradeExecution.ts
index 21c2420..d7b30cc 100644
--- a/src/tools/trading/tradeExecution.ts
+++ b/src/tools/trading/tradeExecution.ts
@@ -618,6 +618,39 @@ export const closePositionTool = createTool({
         };
       }
       
+      // 🔒 防止同周期内平仓保护：检查持仓开仓时间，防止刚开仓就立即平仓
+      // 从数据库获取持仓信息以检查开仓时间
+      const dbClient = createClient({
+        url: process.env.DATABASE_URL || "file:./.voltagent/trading.db",
+      });
+      
+      const dbPositionResult = await dbClient.execute({
+        sql: `SELECT opened_at FROM positions WHERE symbol = ? LIMIT 1`,
+        args: [symbol],
+      });
+      
+      if (dbPositionResult.rows.length > 0) {
+        const openedAt = dbPositionResult.rows[0].opened_at as string;
+        const openedTime = new Date(openedAt).getTime();
+        const now = Date.now();
+        const holdingMinutes = (now - openedTime) / (1000 * 60);
+        
+        // 获取交易周期间隔（分钟）
+        const intervalMinutes = Number.parseInt(process.env.TRADING_INTERVAL_MINUTES || "5");
+        // 最小持仓时间为半个交易周期
+        const minHoldingMinutes = intervalMinutes / 2;
+        
+        // 如果持仓时间少于最小持仓时间，拒绝平仓
+        if (holdingMinutes < minHoldingMinutes) {
+          return {
+            success: false,
+            message: `拒绝平仓 ${symbol}：持仓时间仅 ${holdingMinutes.toFixed(1)} 分钟，少于最小持仓时间 ${minHoldingMinutes.toFixed(1)} 分钟。请等待至少半个交易周期后再评估平仓。这是为了防止在同一周期内刚开仓就立即平仓，造成不必要的手续费损失。`,
+          };
+        }
+        
+        logger.info(`${symbol} 持仓时间: ${holdingMinutes.toFixed(1)} 分钟，通过最小持仓时间检查`);
+      }
+      
       // 从 Gate.io 获取实时数据
       const gateSize = Number.parseInt(gatePosition.size || "0");
       const side = gateSize > 0 ? "long" : "short";
diff --git a/strategies/README.md b/strategies/README.md
deleted file mode 100644
index e08d917..0000000
--- a/strategies/README.md
+++ /dev/null
@@ -1,182 +0,0 @@
-# 交易策略库
-
-本目录包含系统使用的各种交易策略配置。
-
-## 📚 可用策略
-
-### 1. [保守型策略 v1.0](./conservative-strategy-v1.md) 
-**状态**: 已备份（过于保守）
-
-- **特点**: 极度注重风险控制，资本保护优先
-- **入场条件**: ≥3个时间框架共振，潜在利润≥3-5%
-- **适用场景**: 市场极度不确定时，资金安全要求极高
-- **优点**: 极低亏损风险
-- **缺点**: 可能错过很多机会（连续20周期空仓）
-
-### 2. [平衡型策略 v2.0](./balanced-strategy-v2.md) ⭐ 当前使用
-**状态**: 当前使用
-
-- **特点**: 风险收益平衡，积极寻找机会
-- **入场条件**: ≥2个时间框架共振，潜在利润≥2-3%
-- **适用场景**: 正常市场环境，有明确趋势或机会时
-- **优点**: 平衡风险和收益，不会错过太多机会
-- **缺点**: 相比v1风险略有提高（但仍在可控范围）
-
-## 📊 策略对比
-
-| 维度 | v1 保守策略 | v2 平衡策略 |
-|------|------------|------------|
-| 风险等级 | 极低 | 低-中 |
-| 预期收益 | 低 | 中 |
-| 交易频率 | 极低（可能长期空仓） | 适中 |
-| 时间框架要求 | ≥3个 | ≥2个 |
-| 利润目标 | 3-5% | 2-3% |
-| 杠杆使用 | 严格限制 | 灵活运用 |
-| 适合行情 | 震荡/不确定 | 趋势/正常 |
-
-## 🔄 策略切换指南
-
-### 何时使用保守策略（v1）
-
-- ⚠️ 市场极度不确定或剧烈波动
-- ⚠️ 账户出现明显回撤（≥10%）
-- ⚠️ 连续多笔交易亏损
-- ⚠️ 市场处于无序状态
-- ⚠️ 重大事件前（如FOMC、CPI数据发布）
-
-### 何时使用平衡策略（v2）
-
-- ✅ 市场相对稳定或有明确趋势
-- ✅ 账户处于健康状态
-- ✅ 需要提高资金利用率
-- ✅ 长期空仓（如连续>10个周期未交易）
-- ✅ 正常交易环境
-
-## 🔧 如何切换策略
-
-### 方法 1: 手动替换提示词
-
-1. 打开目标策略文档（如 `conservative-strategy-v1.md`）
-2. 复制完整的提示词内容
-3. 打开 `/mnt/code/open-nof1.ai/src/agents/tradingAgent.ts`
-4. 替换 `instructions` 字段内容
-5. 重启系统：`npm run trading:restart`
-
-### 方法 2: 使用 Git 版本控制
-
-```bash
-# 查看当前策略
-git log --oneline src/agents/tradingAgent.ts
-
-# 切换到特定版本
-git checkout <commit-hash> src/agents/tradingAgent.ts
-
-# 重启系统
-npm run trading:restart
-```
-
-## 📈 策略性能监控
-
-建议监控以下指标来评估策略效果：
-
-### 关键指标
-
-1. **交易频率**
-   - v1 保守: 1-3笔/周
-   - v2 平衡: 3-10笔/周
-
-2. **胜率**
-   - 目标: ≥50%
-   - 优秀: ≥60%
-
-3. **盈亏比**
-   - 目标: ≥1.5:1
-   - 优秀: ≥2:1
-
-4. **最大回撤**
-   - 警戒: 10%
-   - 限制: 15%
-   - 强制平仓: 20%
-
-5. **夏普比率**
-   - 目标: ≥1.0
-   - 优秀: ≥1.5
-
-6. **空仓时长**
-   - v1: 可接受长期空仓
-   - v2: 不应连续超过10个周期（100分钟）
-
-### 警告信号
-
-如果出现以下情况，考虑切换策略或暂停交易：
-
-- ❌ 连续5笔交易亏损
-- ❌ 单日回撤超过5%
-- ❌ 胜率低于40%
-- ❌ 盈亏比低于1:1
-- ❌ 最大回撤接近15%
-
-## 📝 策略开发建议
-
-### 创建新策略
-
-1. 复制现有策略文档作为模板
-2. 修改关键参数（时间框架、利润目标、止损止盈等）
-3. 详细记录修改原因和预期效果
-4. 在测试网络充分测试
-5. 在小资金量下实盘验证
-6. 根据表现调整参数
-
-### 策略文档格式
-
-每个策略文档应包含：
-
-- 策略概述和目标
-- 核心理念和交易哲学
-- 具体的入场/出场规则
-- 风险管理规则
-- 适用场景
-- 优缺点分析
-- 与其他策略的对比
-- 完整的提示词内容
-
-## 📚 学习资源
-
-### 推荐阅读
-
-1. 《海龟交易法则》- 关于趋势跟踪和风险管理
-2. 《量化交易》- 系统化交易方法
-3. 《金融怪杰》- 成功交易者的访谈
-4. 《期货市场技术分析》- 技术分析基础
-
-### 相关文档
-
-- [环境变量配置说明](../ENV_CONFIG.md)
-- [系统使用说明](../使用说明.md)
-- [风险管理文档](../RISK_MANAGEMENT.md)（待创建）
-
-## 🔍 版本历史
-
-| 版本 | 日期 | 说明 | 状态 |
-|------|------|------|------|
-| v1.0 | 2025-10-26 | 保守型策略 - 极度风控 | 已备份 |
-| v2.0 | 2025-10-26 | 平衡型策略 - 放宽条件 | ⭐ 当前使用 |
-
-## ⚠️ 重要提醒
-
-1. **没有完美的策略**：所有策略都有优缺点，关键是根据市场环境选择合适的策略
-
-2. **持续监控**：定期检查策略表现，及时调整
-
-3. **风险控制优先**：无论使用哪种策略，风险控制始终是第一位的
-
-4. **记录和复盘**：详细记录每笔交易和策略切换的原因，定期复盘总结
-
-5. **测试优先**：新策略必须先在测试网络充分测试
-
----
-
-**更新日期**: 2025-10-26
-**维护者**: AI Trading System
-
-
-- 
2.34.1

