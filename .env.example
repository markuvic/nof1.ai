# ===========================================
# AI 加密货币自动交易系统 - 环境变量配置
# ===========================================

# ============================================
# 服务器配置
# ============================================
# Web 服务器监听端口
PORT=3100

# ============================================
# 交易配置
# ============================================
# 交易循环间隔（分钟）
# 建议：波段趋势策略使用20分钟，超短线策略使用5分钟
TRADING_INTERVAL_MINUTES=20

# 最大杠杆倍数
MAX_LEVERAGE=25
MAX_POSITIONS=5
MAX_HOLDING_HOURS=36

# 交易策略（ultra-short, swing-trend, conservative, balanced, aggressive）
# ultra-short:   超短线策略（5分钟周期，快进快出，中高风险）
# swing-trend:   波段趋势策略（20分钟周期，捕捉中期趋势，中低风险）
# conservative:  稳健策略（低风险低杠杆，保护本金优先）
# balanced:      平衡策略（风险收益平衡，默认策略）
# aggressive:    激进策略（高风险高杠杆，追求高收益）
#
# 推荐配置组合：
# 1. 波段趋势（中长线）：TRADING_STRATEGY=swing-trend, TRADING_INTERVAL_MINUTES=20
# 2. 超短线（快进快出）：TRADING_STRATEGY=ultra-short, TRADING_INTERVAL_MINUTES=5
# 3. 稳健均衡（默认）  ：TRADING_STRATEGY=balanced, TRADING_INTERVAL_MINUTES=10
TRADING_STRATEGY=swing-trend

# 初始资金（USDT）
INITIAL_BALANCE=1000
ACCOUNT_STOP_LOSS_USDT=50          # 止损线
ACCOUNT_TAKE_PROFIT_USDT=20000      # 止盈线
SYNC_CONFIG_ON_STARTUP=true        # 启动时同步配置

# ============================================
# 数据库配置
# ============================================
# 数据库连接 URL
# 使用本地 SQLite: file:./.voltagent/trading.db
# 使用远程 Turso: libsql://your-database.turso.io
DATABASE_URL=file:./.voltagent/trading.db

# ============================================
# 交易所配置
# ============================================
# 选择交易所（gate 或 binance）
EXCHANGE_PROVIDER=gate

# ---- Gate.io API 配置（当 EXCHANGE_PROVIDER=gate 时必填）----
# Gate.io API 密钥
GATE_API_KEY=your_api_key_here

# Gate.io API 密钥
GATE_API_SECRET=your_api_secret_here

# 是否使用 Gate.io 测试网（true/false）
GATE_USE_TESTNET=true

# ---- Binance API 配置（当 EXCHANGE_PROVIDER=binance 时必填）----
# Binance Futures API 密钥
BINANCE_API_KEY=your_binance_key

# Binance Futures API 密钥
BINANCE_API_SECRET=your_binance_secret

# 是否使用 Binance 测试网（true/false）
BINANCE_USE_TESTNET=true

# Binance API 接口允许的时间窗口(ms)，避免 timestamp 超出范围
BINANCE_RECV_WINDOW=5000

# Binance 请求超时设置（毫秒，可根据网络情况调整）
BINANCE_TIMEOUT_MS=15000

# Binance 请求最大重试次数（网络波动时用于自动重试）
BINANCE_MAX_RETRIES=2

# Binance 持仓模式（可选：ONE_WAY 或 HEDGE；留空则自动探测）
BINANCE_POSITION_MODE=

# ---- Dry-Run 模式配置（使用真实行情，本地模拟资金）----
# 将 EXCHANGE_DRY_RUN 设置为 true 即可启用 dry-run 模式（仅支持 Binance 数据）
EXCHANGE_DRY_RUN=false
# 虚拟账户初始资金（USDT）
DRY_RUN_INITIAL_BALANCE=1000
# 每笔交易手续费（基点，1bp = 0.01%），默认 5bp = 0.05%
DRY_RUN_FEE_BPS=5
# 市价撮合滑点设置（基点），默认 10bp = 0.10%
DRY_RUN_SLIPPAGE_BPS=10
# 额外预留的保证金缓冲（基点），默认 50bp = 0.50%
DRY_RUN_MARGIN_BUFFER_BPS=50
# Dry-Run 状态快照存储路径（可选，自定义缓存位置）
#DRY_RUN_STATE_PATH=.voltagent/dry-run-state.json
# 启动时是否清空 Dry-Run 状态缓存
DRY_RUN_RESET=false
# 订单簿流动性检查乘数（默认 2.5 倍名义敞口）
ORDERBOOK_LIQUIDITY_MULTIPLIER=2.5

# ============================================
# Telegram 机器人通知（可选）
# ============================================
# Telegram Bot Token（启用通知和命令交互所需）
TELEGRAM_BOT_TOKEN=
# 允许交互的 Chat ID（逗号分隔，可选；为空表示首次对话即自动授权）
TELEGRAM_ALLOWED_CHAT_IDS=
# 推送通知的 Chat ID（逗号分隔；未指定时默认使用允许列表/首次对话的聊天）
TELEGRAM_NOTIFY_CHAT_IDS=

# ============================================
# AI 模型配置
# ============================================
# OpenAI 兼容的 API 密钥（必需）
# 支持 OpenAI、OpenRouter 或其他兼容供应商
OPENAI_API_KEY=your_api_key_here

# OpenAI 兼容的 API 基础地址（可选）
# OpenRouter: https://openrouter.ai/api/v1
# OpenAI: https://api.openai.com/v1
# DeepSeek: https://api.deepseek.com/v1
# 或其他兼容 OpenAI API 的供应商地址
OPENAI_BASE_URL=https://openrouter.ai/api/v1

# AI 模型名称（可选，默认使用 deepseek/deepseek-v3.2-exp）
# 注意：不同供应商的模型名称不同
# OpenRouter: deepseek/deepseek-v3.2-exp, x-ai/grok-4-fast, 等
# OpenAI: gpt-4, gpt-3.5-turbo, 等
# DeepSeek: deepseek-chat, deepseek-coder, 等
AI_MODEL_NAME=deepseek/deepseek-v3.2-exp
#AI_MODEL_NAME=x-ai/grok-4-fast

# AI Agent 类型（default | naked-k）
AI_AGENT_PROFILE=default
# 裸K Agent 使用的时间框架模板（baseline | scalper | swing）
NAKED_K_PROFILE=baseline

# ============================================
# 系统风控（独立止盈止损）
# ============================================
# 优先级/共存关系
#     系统风控每次巡检都会按顺序检查「移动止盈 → 固定止盈 → 固定止损」。也就是说：
#       1. 如果 SYSTEM_TRAILING_ENABLED=true 且达到某一档条件，会先执行该档移动止盈（一个仓位一轮只执行一次，执行后 system_trailing_level、system_tp_count 被
#       2. 如果移动止盈没有触发，才会继续检查固定止盈 (SYSTEM_TAKE_PROFIT_ENABLED + SYSTEM_TAKE_PROFIT_PERCENT)。
#       3. 如果前两个都未触发，再检查固定止损 (SYSTEM_STOP_LOSS_ENABLED + SYSTEM_STOP_LOSS_PERCENT)。

#     所以你可以同时开启三者：移动止盈优先锁定峰值，若当前利润不足以触发移动止盈但仍超过固定阈值，则会执行固定止盈；亏损到止损线则走固定止损。不会冲突，但要根据
#     该配置是一个逗号或分号分隔的列表，每个“档位”用 trigger:lock:closePercent 表示：
#       - trigger：触发门槛，表示“历史最高杠杆盈亏达到多少百分比时进入该档”。
#       - lock：锁定线，当当前盈亏回落到该值或以下时触发移动止盈。
#       - closePercent：触发后平仓的仓位比例（百分比）。

#     例如：

#     SYSTEM_TRAILING_TIERS=5:2:25,10:5:50,15:12:100

#     解释：
#       1. 第一档：如果某仓位的峰值盈亏 ≥ +5%，系统开始监控；当盈亏回落至 +2% 或以下时，自动平掉 25% 仓位（锁 25% 利润），并重置峰值/档位以重新累积。
#       2. 第二档：若峰值进一步达到 +10%，锁定线升到 +5%；当利润回落至 +5% 或以下时，平掉 50% 仓位。
#       3. 第三档：峰值 ≥ +15% 时，锁定线为 +12%；一旦回落到 +12% 或以下，直接全平（closePercent=100），彻底锁住高位利润。

#     档位会按 trigger 递增顺序自动排序；每达到更高档位，就用新的锁定线。触发后该档位会重置，允许仓位重新累积新的峰值并再次进入档位。

#     你可以按策略增减档位或调整数值，例如：
#       - 只需一个档位：SYSTEM_TRAILING_TIERS=8:4:50（盈利 8% 开始监控，回落到 4% 平 50%）
#       - 更激进的策略：SYSTEM_TRAILING_TIERS=3:1:20,6:3:50,9:7:100

#     如果设置为空或 SYSTEM_TRAILING_ENABLED=false，则完全关闭移动止盈逻辑，仅保留固定止盈/止损。

SYSTEM_PROTECTION_ENABLED=false
SYSTEM_TAKE_PROFIT_ENABLED=true
SYSTEM_TAKE_PROFIT_PERCENT=8
SYSTEM_TAKE_PROFIT_CLOSE_PERCENT=50
SYSTEM_TAKE_PROFIT_MAX_TRIGGERS=2
SYSTEM_STOP_LOSS_ENABLED=true
SYSTEM_STOP_LOSS_PERCENT=5
SYSTEM_STOP_LOSS_CLOSE_PERCENT=100
SYSTEM_PROTECTION_INTERVAL_SECONDS=60
SYSTEM_TRAILING_ENABLED=false
# 触发层级配置: trigger:lock:closePercent，多层用逗号分隔
SYSTEM_TRAILING_TIERS=5:2:25,10:5:50,15:12:100

# AI 输出最大 Token（防止回复被截断）
AI_MAX_OUTPUT_TOKENS=4096

# ============================================
# 账户回撤风控配置
# ============================================
# 当账户资产相比峰值回撤达到以下百分比时的风控措施：
ACCOUNT_DRAWDOWN_WARNING_PERCENT=20          # 警告阈值：发出风险警告提醒
ACCOUNT_DRAWDOWN_NO_NEW_POSITION_PERCENT=30  # 禁止开仓阈值：停止开新仓位，只允许平仓
ACCOUNT_DRAWDOWN_FORCE_CLOSE_PERCENT=50      # 强制平仓阈值：自动平掉所有仓位，保护剩余资金
